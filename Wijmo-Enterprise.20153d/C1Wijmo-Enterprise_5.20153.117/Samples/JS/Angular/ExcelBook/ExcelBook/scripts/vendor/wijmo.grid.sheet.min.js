/*
    *
    * Wijmo Library 5.20153.117
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the Wijmo Commercial License.
    * sales@wijmo.com
    * http://wijmo.com/products/wijmo-5/license/
    *
    */
var __extends,wijmo;(function(n){(function(t){(function(i){'use strict';var o=function(){function e(t){this._expressionCache={};this._idChars='$:!';this._functionTable={};this._cacheSize=0;this.unknownFunction=new n.Event;this._owner=t;this._buildSymbolTable();this._registerAggregateFunction();this._registerMathFunction();this._registerLogicalFunction();this._registerTextFunction();this._registerDateFunction();this._registLookUpReferenceFunction();this._registFinacialFunction()}return e.prototype.onUnknownFunction=function(n,t){var f,u,r;if(t&&t.length>0)for(f=[],r=0;r<t.length;r++)f[r]=t[r].evaluate();if(u=new i.UnknownFunctionEventArgs(n,f),this.unknownFunction.raise(this,u),u.value!=null)return new i._Expression(u.value);throw'The function "'+n+'" has not supported in FlexSheet yet.';},e.prototype.evaluate=function(t,r,u,f,e){var s,o;try{if(t&&t.length>1&&t[0]==='='){for(s=this._checkCache(t),o=s.evaluate(u,f,e);o instanceof i._Expression;)o=o.evaluate(u);return r&&n.isPrimitive(o)?n.Globalize.format(o,r):o}return t?t:''}catch(h){return"Error: "+h}},e.prototype.addCustomFunction=function(n,t,u,f,e){typeof e=="undefined"&&(e=!1);var o=this;return(n=n.toLowerCase(),e===!1&&this._functionTable[n])?!1:(this._functionTable[n]=new r(function(n){var u,f=[],r;if(n.length>0)for(r=0;r<n.length;r++)u=n[r],f[r]=u instanceof i._CellRangeExpression?u.cells:u.evaluate();return t.apply(o,f)},f,u),!0)},e.prototype._parse=function(n){return this._expression=n,this._expressLength=n?n.length:0,this._pointer=0,this._expressLength>0&&this._expression[0]==='='&&this._pointer++,this._parseExpression()},e.prototype._buildSymbolTable=function(){this._tokenTable||(this._tokenTable={},this._addToken('+',6,1),this._addToken('-',7,1),this._addToken('(',14,5),this._addToken(')',15,5),this._addToken('*',8,2),this._addToken(',',17,5),this._addToken('.',18,5),this._addToken('/',9,2),this._addToken('\\',10,2),this._addToken('=',4,0),this._addToken('>',0,0),this._addToken('<',1,0),this._addToken('^',12,3),this._addToken("<>",5,0),this._addToken(">=",2,0),this._addToken("<=",3,0),this._addToken('&',13,4))},e.prototype._registerAggregateFunction=function(){var n=this;n._functionTable.sum=new r(function(t,i){return n._getAggregateResult(1,t,i)});n._functionTable.average=new r(function(t,i){return n._getAggregateResult(3,t,i)});n._functionTable.max=new r(function(t,i){return n._getAggregateResult(4,t,i)});n._functionTable.min=new r(function(t,i){return n._getAggregateResult(5,t,i)});n._functionTable['var']=new r(function(t,i){return n._getAggregateResult(8,t,i)});n._functionTable.varp=new r(function(t,i){return n._getAggregateResult(10,t,i)});n._functionTable.stdev=new r(function(t,i){return n._getAggregateResult(7,t,i)});n._functionTable.stdevp=new r(function(t,i){return n._getAggregateResult(9,t,i)});n._functionTable.count=new r(function(t,i){return n._getFlexSheetAggregateResult(0,t,i)});n._functionTable.counta=new r(function(t,i){return n._getFlexSheetAggregateResult(1,t,i)});n._functionTable.countblank=new r(function(t,i){return n._getFlexSheetAggregateResult(2,t,i)});n._functionTable.countif=new r(function(t,i){return n._getFlexSheetAggregateResult(3,t,i)},2,2);n._functionTable.countifs=new r(function(t,i){return n._getFlexSheetAggregateResult(4,t,i)},254,2);n._functionTable.sumif=new r(function(t,i){return n._getFlexSheetAggregateResult(6,t,i)},3,2);n._functionTable.sumifs=new r(function(t,i){return n._getFlexSheetAggregateResult(7,t,i)},255,2);n._functionTable.rank=new r(function(t,i){return n._getFlexSheetAggregateResult(5,t,i)},3,2);n._functionTable.product=new r(function(t,i){return n._getFlexSheetAggregateResult(8,t,i)},255,1);n._functionTable.subtotal=new r(function(t,i){return n._handleSubtotal(t,i)},255,2);n._functionTable.dcount=new r(function(t,i){return n._handleDCount(t,i)},3,3)},e.prototype._registerMathFunction=function(){var t=this;t._functionTable.pi=new r(function(){return Math.PI},0,0);t._functionTable.rand=new r(function(){return Math.random()},0,0);t._functionTable.power=new r(function(n,t){return Math.pow(i._Expression.toNumber(n[0],t),i._Expression.toNumber(n[1],t))},2,2);t._functionTable.atan2=new r(function(n,t){var r=i._Expression.toNumber(n[0],t),u=i._Expression.toNumber(n[1],t);if(r===0&&u===0)throw'The x number and y number can\'t both be zero for the atan2 function';return Math.atan2(u,r)},2,2);t._functionTable.mod=new r(function(n,t){return i._Expression.toNumber(n[0],t)%i._Expression.toNumber(n[1],t)},2,2);t._functionTable.trunc=new r(function(n,t){var r=i._Expression.toNumber(n[0],t),f=n.length===2?i._Expression.toNumber(n[1],t):0,u;return f===0?r>=0?Math.floor(r):Math.ceil(r):(u=Math.pow(10,f),r>=0?Math.floor(r*u)/u:Math.ceil(r*u)/u)},2,1);['round','rounddown','roundup'].forEach(function(u){t._functionTable[u]=new r(function(t,r){var f=i._Expression.toNumber(t[0],r),o=i._Expression.toNumber(t[1],r),e;if(o===0){switch(u){case'rounddown':return f>=0?Math.floor(f):Math.ceil(f);case'roundup':return f>=0?Math.ceil(f):Math.floor(f);case'round':return Math.round(f)}return Math.floor(f)}if(o>0&&n.isInt(o)){e=Math.pow(10,o);switch(u){case'rounddown':return f>=0?Math.floor(f*e)/e:Math.ceil(f*e)/e;case'roundup':return f>=0?Math.ceil(f*e)/e:Math.floor(f*e)/e;case'round':return Math.round(f*e)/e}}throw'Invalid precision!';},2,2)});['abs','acos','asin','atan','ceiling','cos','exp','floor','ln','sin','sqrt','tan'].forEach(function(n){t._functionTable[n]=new r(function(t,r){switch(n){case'ceiling':return Math.ceil(i._Expression.toNumber(t[0],r));case'ln':return Math.log(i._Expression.toNumber(t[0],r));default:return Math[n](i._Expression.toNumber(t[0],r))}},1,1)})},e.prototype._registerLogicalFunction=function(){this._functionTable.and=new r(function(n,t){for(var r=!0,u=0;u<n.length;u++)if(r=r&&i._Expression.toBoolean(n[u],t),!r)break;return r},Number.MAX_VALUE,1);this._functionTable.or=new r(function(n,t){for(var r=!1,u=0;u<n.length;u++)if(r=r||i._Expression.toBoolean(n[u],t),r)break;return r},Number.MAX_VALUE,1);this._functionTable.not=new r(function(n,t){return!i._Expression.toBoolean(n[0],t)},1,1);this._functionTable['if']=new r(function(n,t){return i._Expression.toBoolean(n[0],t)?n[1].evaluate(t):n[2].evaluate(t)},3,3);this._functionTable['true']=new r(function(){return!0},0,0);this._functionTable['false']=new r(function(){return!1},0,0)},e.prototype._registerTextFunction=function(){this._functionTable.char=new r(function(n,t){for(var u='',r=0;r<n.length;r++)u+=String.fromCharCode(i._Expression.toNumber(n[r],t));return u},Number.MAX_VALUE,1);this._functionTable.code=new r(function(n,t){var r=i._Expression.toString(n[0],t);return r&&r.length>0?r.charCodeAt(0):-1},1,1);this._functionTable.concatenate=new r(function(n,t){for(var u='',r=0;r<n.length;r++)u=u.concat(i._Expression.toString(n[r],t));return u},Number.MAX_VALUE,1);this._functionTable.left=new r(function(n,t){var r=i._Expression.toString(n[0],t),u=Math.floor(i._Expression.toNumber(n[1],t));return r&&r.length>0?r.slice(0,u):undefined},2,2);this._functionTable.right=new r(function(n,t){var r=i._Expression.toString(n[0],t),u=Math.floor(i._Expression.toNumber(n[1],t));return r&&r.length>0?r.slice(-u):undefined},2,2);this._functionTable.find=new r(function(n,t){var u=i._Expression.toString(n[0],t),f=i._Expression.toString(n[1],t),r;return f!=null&&u!=null&&(r=f.indexOf(u),r>-1)?r+1:-1},2,2);this._functionTable.search=new r(function(n,t){var u=i._Expression.toString(n[0],t),f=i._Expression.toString(n[1],t),e,r;return f!=null&&u!=null&&(e=new RegExp(u,'i'),r=f.search(e),r>-1)?r+1:-1},2,2);this._functionTable.len=new r(function(n,t){var r=i._Expression.toString(n[0],t);return r?r.length:-1},1,1);this._functionTable.mid=new r(function(n,t){var r=i._Expression.toString(n[0],t),u=Math.floor(i._Expression.toNumber(n[1],t)),f=Math.floor(i._Expression.toNumber(n[2],t));return r&&r.length>0&&u>0?r.substr(u-1,f):undefined},3,3);this._functionTable.lower=new r(function(n,t){var r=i._Expression.toString(n[0],t);return r&&r.length>0?r.toLowerCase():undefined},1,1);this._functionTable.upper=new r(function(n,t){var r=i._Expression.toString(n[0],t);return r&&r.length>0?r.toUpperCase():undefined},1,1);this._functionTable.proper=new r(function(n,t){var r=i._Expression.toString(n[0],t);return r&&r.length>0?r[0].toUpperCase()+r.substring(1).toLowerCase():undefined},1,1);this._functionTable.trim=new r(function(n,t){var r=i._Expression.toString(n[0],t);return r&&r.length>0?r.trim():undefined},1,1);this._functionTable.replace=new r(function(n,t){var r=i._Expression.toString(n[0],t),u=Math.floor(i._Expression.toNumber(n[1],t)),f=Math.floor(i._Expression.toNumber(n[2],t)),e=i._Expression.toString(n[3],t);return r&&r.length>0&&u>0?r.substring(0,u-1)+e+r.slice(u-1+f):undefined},4,4);this._functionTable.substitute=new r(function(n,t){var r=i._Expression.toString(n[0],t),u=i._Expression.toString(n[1],t),e=i._Expression.toString(n[2],t),f;return r&&r.length>0&&u&&u.length>0?(f=new RegExp(u,'g'),r.replace(f,e)):undefined},3,3);this._functionTable.rept=new r(function(n,t){var r=i._Expression.toString(n[0],t),e=Math.floor(i._Expression.toNumber(n[1],t)),u='',f;if(r&&r.length>0&&e>0)for(f=0;f<e;f++)u=u.concat(r);return u},2,2);this._functionTable.text=new r(function(t,r){var u=t[0].evaluate(),f=i._Expression.toString(t[1],r);return n.Globalize.format(u,f)},2,2);this._functionTable.value=new r(function(n,t){return i._Expression.toNumber(n[0],t)},1,1)},e.prototype._registerDateFunction=function(){this._functionTable.now=new r(function(){return{value:new Date,format:'M/d/yyyy h:mm'}},0,0);this._functionTable.today=new r(function(){return{value:new Date,format:'d'}},0,0);this._functionTable.year=new r(function(t,r){var u=i._Expression.toDate(t[0],r);return!n.isPrimitive(u)&&u?u.value:n.isDate(u)?u.getFullYear():1900},1,1);this._functionTable.month=new r(function(t,r){var u=i._Expression.toDate(t[0],r);return!n.isPrimitive(u)&&u?u.value:n.isDate(u)?u.getMonth()+1:1},1,1);this._functionTable.day=new r(function(t,r){var u=i._Expression.toDate(t[0],r);return!n.isPrimitive(u)&&u?u.value:n.isDate(u)?u.getDate():0},1,1);this._functionTable.hour=new r(function(t,r){var u=t[0].evaluate(r);if(n.isNumber(u)&&!isNaN(u))return Math.floor(24*(u-Math.floor(u)));if(n.isDate(u)||(u=i._Expression.toDate(t[0],r),!n.isPrimitive(u)&&u&&(u=u.value),n.isDate(u)))return u.getHours();throw'Invalid parameter.';},1,1);this._functionTable.time=new r(function(t,i){var r=t[0].evaluate(i),u=t[1].evaluate(i),f=t[2].evaluate(i);if(n.isNumber(r)&&n.isNumber(u)&&n.isNumber(f))return r%=24,u%=60,f%=60,{value:new Date(0,0,0,r,u,f),format:'t'};throw'Invalid parameters.';},3,3);this._functionTable.date=new r(function(t,i){var r=t[0].evaluate(i),u=t[1].evaluate(i),f=t[2].evaluate(i);if(n.isNumber(r)&&n.isNumber(u)&&n.isNumber(f))return{value:new Date(r,u-1,f),format:'d'};throw'Invalid parameters.';},3,3);this._functionTable.datedif=new r(function(t,r){var f=i._Expression.toDate(t[0],r),u=i._Expression.toDate(t[1],r),l=t[2].evaluate(r),h,c,o,e,s;if(!n.isPrimitive(f)&&f&&(f=f.value),!n.isPrimitive(u)&&u&&(u=u.value),n.isDate(f)&&n.isDate(u)&&n.isString(l)){if(h=f.getTime(),c=u.getTime(),h>c)throw'Start date is later than end date.';o=u.getDate()-f.getDate();e=u.getMonth()-f.getMonth();s=u.getFullYear()-f.getFullYear();switch(l.toUpperCase()){case'Y':return e>0?s:e<0?s-1:o>=0?s:s-1;case'M':return o>=0?s*12+e:s*12+e-1;case'D':return(c-h)/864e5;case'YM':return e=o>=0?s*12+e:s*12+e-1,e%12;case'YD':return e>0?(new Date(f.getFullYear(),u.getMonth(),u.getDate()).getTime()-f.getTime())/864e5:e<0?(new Date(f.getFullYear()+1,u.getMonth(),u.getDate()).getTime()-f.getTime())/864e5:o>=0?o:(new Date(f.getFullYear()+1,u.getMonth(),u.getDate()).getTime()-f.getTime())/864e5;case'MD':return o>=0?o:new Date(u.getFullYear(),u.getMonth(),0).getDate()-new Date(u.getFullYear(),u.getMonth()-1,1).getDate()+1+o;default:throw'Invalid unit.';}}throw'Invalid parameters.';},3,3)},e.prototype._registLookUpReferenceFunction=function(){var n=this;n._functionTable.column=new r(function(t,r,u,f){var e;if(t==null)return f+1;if(e=t[0],e=n._ensureNonFunctionExpression(e),e instanceof i._CellRangeExpression)return e.cells.col+1;throw'Invalid Cell Reference.';},1,0);n._functionTable.columns=new r(function(t){var r=t[0];if(r=n._ensureNonFunctionExpression(r),r instanceof i._CellRangeExpression)return r.cells.columnSpan;throw'Invalid Cell Reference.';},1,1);n._functionTable.row=new r(function(t,r,u){var f;if(t==null)return u+1;if(f=t[0],f=n._ensureNonFunctionExpression(f),f instanceof i._CellRangeExpression)return f.cells.row+1;throw'Invalid Cell Reference.';},1,0);n._functionTable.rows=new r(function(t){var r=t[0];if(r=n._ensureNonFunctionExpression(r),r instanceof i._CellRangeExpression)return r.cells.rowSpan;throw'Invalid Cell Reference.';},1,1);n._functionTable.choose=new r(function(n,t){var r=i._Expression.toNumber(n[0],t);if(isNaN(r))throw'Invalid index number.';if(r<1||r>=n.length)throw'The index number is out of the list range.';return n[r].evaluate(t)},255,2);n._functionTable.index=new r(function(r,u){var s=r[0],f,e=i._Expression.toNumber(r[1],u),o=r[2]!=null?i._Expression.toNumber(r[2],u):0;if(isNaN(e)||e<0)throw'Invalid Row Number.';if(isNaN(o)||o<0)throw'Invalid Column Number.';if(s=n._ensureNonFunctionExpression(s),s instanceof i._CellRangeExpression){if(f=s.cells,e>f.rowSpan||o>f.columnSpan)throw'Index is out of the cell range.';if(e>0&&o>0)return n._owner.getCellValue(f.topRow+e-1,f.leftCol+o-1,!0,u);if(e===0&&o===0)return s;if(e===0)return new i._CellRangeExpression(new t.CellRange(f.topRow,f.leftCol+o-1,f.bottomRow,f.leftCol+o-1),s.sheetRef,n._owner);if(o===0)return new i._CellRangeExpression(new t.CellRange(f.topRow+e-1,f.leftCol,f.topRow+e-1,f.rightCol),s.sheetRef,n._owner)}throw'Invalid Cell Reference.';},4,2);n._functionTable.hlookup=new r(function(t,i){return n._handleHLookup(t,i)},4,3)},e.prototype._registFinacialFunction=function(){var n=this;n._functionTable.rate=new r(function(t,i){var r=n._calculateRate(t,i);return{value:r,format:'p2'}},6,3)},e.prototype._addToken=function(n,t,i){var r=new u(n,t,i);this._tokenTable[n]=r},e.prototype._parseExpression=function(){return this._getToken(),this._parseCompareOrConcat()},e.prototype._parseCompareOrConcat=function(){for(var n=this._parseAddSub(),t,r;this._token.tokenType===0||this._token.tokenType===4;)t=this._token,this._getToken(),r=this._parseAddSub(),n=new i._BinaryExpression(t,n,r);return n},e.prototype._parseAddSub=function(){for(var n=this._parseMulDiv(),t,r;this._token.tokenType===1;)t=this._token,this._getToken(),r=this._parseMulDiv(),n=new i._BinaryExpression(t,n,r);return n},e.prototype._parseMulDiv=function(){for(var n=this._parsePower(),t,r;this._token.tokenType===2;)t=this._token,this._getToken(),r=this._parsePower(),n=new i._BinaryExpression(t,n,r);return n},e.prototype._parsePower=function(){for(var n=this._parseUnary(),t,r;this._token.tokenType===3;)t=this._token,this._getToken(),r=this._parseUnary(),n=new i._BinaryExpression(t,n,r);return n},e.prototype._parseUnary=function(){var n,t;return this._token.tokenID===6||this._token.tokenID===7?(n=this._token,this._getToken(),t=this._parseAtom(),new i._UnaryExpression(n,t)):this._parseAtom()},e.prototype._parseAtom=function(){var n=null,u,t,r,e,f;switch(this._token.tokenType){case 6:n=new i._Expression(this._token);break;case 7:if(u=this._token.value.toString(),t=this._functionTable[u.toLowerCase()],t){if(r=this._getParameters(),e=r?r.length:0,t.paramMin!==-1&&e<t.paramMin)throw'Too few parameters.';if(t.paramMax!==-1&&e>t.paramMax)throw'Too many parameters.';n=new i._FunctionExpression(t,r);break}if(f=this._getCellRange(u),f){n=new i._CellRangeExpression(f.cellRange,f.sheetRef,this._owner);break}r=this._getParameters();n=this.onUnknownFunction(u,r);break;case 5:if(this._token.tokenID!==14)throw'Expression expected.';if(this._getToken(),n=this._parseCompareOrConcat(),this._token.tokenID!==15)throw'Unbalanced parenthesis.';}if(n===null)throw'';return this._getToken(),n},e.prototype._getToken=function(){for(var t,n,s,f,e,o='',i='',h=new RegExp('[\u3000-\u303f\u3040-\u309f\u30a0-\u30ff\uff00-\uff9f\u4e00-\u9faf\u3400-\u4dbf]'),r;this._pointer<this._expressLength&&this._expression[this._pointer]===' ';)this._pointer++;if(this._pointer>=this._expressLength){this._token=new u(null,16,5);return}if(n=this._expression[this._pointer],f=n>='a'&&n<='z'||n>='A'&&n<='Z'||h.test(n),e=n>='0'&&n<='9'||n=='.',!f&&!e&&(r=this._tokenTable[n],r)){this._token=r;this._pointer++;this._pointer<this._expressLength&&(n==='>'||n==='<')&&(r=this._tokenTable[this._expression.substring(this._pointer-1,this._pointer+1)],r&&(this._token=r,this._pointer++));return}if(e){this._parseDigit();return}if(n==='\"'){this._parseString();return}if(n!=='\''||(i=this._parseSheetRef(),i)){if(n==='#'){this._parseDate();return}if(!f&&n!=='_'&&this._idChars.indexOf(n)<0&&!i)throw'Identifier expected.';for(t=1;t+this._pointer<this._expressLength;t++){if(n=this._expression[this._pointer+t],f=n>='a'&&n<='z'||n>='A'&&n<='Z'||h.test(n),e=n>='0'&&n<='9',n==='\''&&s===':'){o=i+this._expression.substring(this._pointer,this._pointer+t);this._pointer+=t;i=this._parseSheetRef();t=0;continue}if(s=n,!f&&!e&&n!=='_'&&this._idChars.indexOf(n)<0)break}o+=i+this._expression.substring(this._pointer,this._pointer+t);this._pointer+=t;this._token=new u(o,19,7)}},e.prototype._parseDigit=function(){for(var i=-1,f=!1,e=!1,r=0,n,o,t=0;t+this._pointer<this._expressLength;t++){if(n=this._expression[this._pointer+t],n>='0'&&n<='9'){r=r*10+(+n-0);i>-1&&(i*=10);continue}if(n==='.'&&i<0){i=1;continue}if((n==='E'||n==='e')&&!f){f=!0;n=this._expression[this._pointer+t+1];(n==='+'||n==='-')&&t++;continue}if(n==='%'){e=!0;t++;break}break}f?(o=this._expression.substring(this._pointer,this._pointer+t),r=+o):(i>1&&(r/=i),e&&(r/=100));this._token=new u(r,19,6);this._pointer+=t},e.prototype._parseString=function(){for(var t,i,r,n=1;n+this._pointer<this._expressLength;n++)if(t=this._expression[this._pointer+n],t==='\"'){if(i=n+this._pointer<this._expressLength-1?this._expression[this._pointer+n+1]:' ',i!=='\"')break;n++}if(t!=='\"')throw'Can\'t find final quote.';if(r=this._expression.substring(this._pointer+1,this._pointer+n),this._pointer+=n+1,this._expression[this._pointer]==='!')throw'Illegal cross sheet reference.';this._token=new u(r.replace('\"\"','\"'),19,6)},e.prototype._parseDate=function(){for(var t,i,n=1;n+this._pointer<this._expressLength;n++)if(t=this._expression[this._pointer+n],t==='#')break;if(t!=='#')throw'Can\'t find final date delimiter ("#").';i=this._expression.substring(this._pointer+1,this._pointer+n);this._pointer+=n+1;this._token=new u(Date.parse(i),19,6)},e.prototype._parseSheetRef=function(){for(var t,i,r,n=1;n+this._pointer<this._expressLength;n++)if(t=this._expression[this._pointer+n],t==='\''){if(i=n+this._pointer<this._expressLength-1?this._expression[this._pointer+n+1]:' ',i!=='\'')break;n++}if(t!=='\'')throw'Can\'t find final quote.';return r=this._expression.substring(this._pointer+1,this._pointer+n),this._pointer+=n+1,this._expression[this._pointer]==='!'?r.replace(/\'\'/g,'\''):''},e.prototype._getCellRange=function(n){var i,r,u,t,f;if(n&&(i=n.split(':'),i.length>0&&i.length<3&&(r=this._parseCell(i[0]),t=r.cellRange,t&&i.length===2))){if(u=this._parseCell(i[1]),f=u.cellRange,r.sheetRef&&!u.sheetRef&&(u.sheetRef=r.sheetRef),r.sheetRef!==u.sheetRef)throw'The cell reference must be in the same sheet!';f?(t.col2=f.col,t.row2=f.row):t=null}return t==null?null:{cellRange:t,sheetRef:r.sheetRef}},e.prototype._parseCellRange=function(n){for(var u=-1,f=-1,e=!1,o=!1,i,r=0;r<n.length;r++){if(i=n[r],i==='$'&&!e){e=!0;continue}if(!(i>='a'&&i<='z')&&!(i>='A'&&i<='Z'))break;u<0&&(u=0);u=26*u+(i.toUpperCase().charCodeAt(0)-'A'.charCodeAt(0)+1)}for(;r<n.length;r++){if(i=n[r],i==='$'&&!o){o=!0;continue}if(!(i>='0'&&i<='9'))break;f<0&&(f=0);f=10*f+(+i-0)}return(r<n.length&&(f=u=-1),f===-1||u===-1)?null:new t.CellRange(f-1,u-1)},e.prototype._parseCell=function(n){var r,t,i,u;if(t=n.lastIndexOf('!'),t>0&&t<n.length-1)u=n.substring(0,t),i=n.substring(t+1);else if(t<=0)i=n;else return null;return r=this._parseCellRange(i),{cellRange:r,sheetRef:u}},e.prototype._getParameters=function(){var i=this._pointer,r=this._token,n,t;if(this._getToken(),this._token.tokenID!==14)return this._pointer=i,this._token=r,null;if(i=this._pointer,this._getToken(),this._token.tokenID===15)return null;for(this._pointer=i,n=[],t=this._parseExpression(),n.push(t);this._token.tokenID===17;)t=this._parseExpression(),n.push(t);if(this._token.tokenID!==15)throw'Syntax error.';return n},e.prototype._getAggregateResult=function(t,i,r){var u=this._getItemList(i,r);return n.getAggregate(t,u)},e.prototype._getFlexSheetAggregateResult=function(n,t,r){var u,o,f,e;switch(n){case 0:return u=this._getItemList(t,r,!0,!1),this._countNumberCells(u);case 1:return u=this._getItemList(t,r,!1,!1),u.length;case 2:return u=this._getItemList(t,r,!1,!0),this._countBlankCells(u);case 5:if(f=i._Expression.toNumber(t[0],r),e=t[2]?i._Expression.toNumber(t[2],r):0,isNaN(f))throw'Invalid number.';if(isNaN(e))throw'Invalid order.';if(t[1]=this._ensureNonFunctionExpression(t[1]),t[1]instanceof i._CellRangeExpression)return u=this._getItemList([t[1]],r),this._getRankOfCellRange(f,u,e);throw'Invalid Cell Reference.';case 3:if(t[0]=this._ensureNonFunctionExpression(t[0]),t[0]instanceof i._CellRangeExpression)return u=this._getItemList([t[0]],r,!1),this._countCellsByCriterias([u],[t[1]],r);throw'Invalid Cell Reference.';case 4:return this._handleCountIfs(t,r);case 6:if(t[0]=this._ensureNonFunctionExpression(t[0]),t[0]instanceof i._CellRangeExpression)return u=this._getItemList([t[0]],r,!1),t[2]=this._ensureNonFunctionExpression(t[2]),t[2]!=null&&t[2]instanceof i._CellRangeExpression&&(o=this._getItemList([t[2]],r)),this._sumCellsByCriterias([u],[t[1]],o,r);throw'Invalid Cell Reference.';case 7:return this._handleSumIfs(t,r);case 8:return u=this._getItemList(t,r),this._getProductOfNumbers(u)}throw'Invalid aggregate type.';},e.prototype._getItemList=function(n,t,r,u,f,e){typeof r=="undefined"&&(r=!0);typeof u=="undefined"&&(u=!1);typeof f=="undefined"&&(f=!0);for(var l=[],o,c,a,s,h=0;h<n.length;h++)if(s=n[h],s=this._ensureNonFunctionExpression(s),s instanceof i._CellRangeExpression){a=s.getValues(f,e,t);n:for(c=0;c<a.length;c++)(o=a[c],u||o!=null&&o!=='')&&(o=r?+o:o,l.push(o))}else{if(o=s instanceof i._Expression?s.evaluate(t):s,!u&&(o==null||o===''))continue;o=r?+o:o;l.push(o)}return l},e.prototype._countBlankCells=function(t){for(var r=0,u=0,i;r<t.length;r++)i=t[r],(i==null||n.isString(i)&&i===''||n.isNumber(i)&&isNaN(i))&&u++;return u},e.prototype._countNumberCells=function(t){for(var r=0,u=0,i;r<t.length;r++)i=t[r],i!=null&&n.isNumber(i)&&!isNaN(i)&&u++;return u},e.prototype._getRankOfCellRange=function(n,t,i){typeof i=="undefined"&&(i=0);var r=0,f=0,u;for(i?t.sort(function(n,t){return isNaN(n)||isNaN(t)?-1:n-t}):t.sort(function(n,t){return isNaN(n)||isNaN(t)?1:t-n});r<t.length;r++)if((u=t[r],!isNaN(u))&&(f++,n===u))return f;throw n+' is not in the cell range.';},e.prototype._handleCountIfs=function(n,t){var u=0,f=[],e=[],r,o,s;if(n.length%2!=0)throw'Invalid params.';for(;u<n.length/2;u++)if(r=n[2*u],r=this._ensureNonFunctionExpression(r),r instanceof i._CellRangeExpression){if(u===0)if(r.cells)o=r.cells.rowSpan,s=r.cells.columnSpan;else throw'Invalid Cell Reference.';else if(r.cells){if(r.cells.rowSpan!==o||r.cells.columnSpan!==s)throw'The row span and column span of each cell range has to be same with each other.';}else throw'Invalid Cell Reference.';f[u]=this._getItemList([r],t,!1);e[u]=n[2*u+1]}else throw'Invalid Cell Reference.';return this._countCellsByCriterias(f,e,t)},e.prototype._countCellsByCriterias=function(t,r,u,f){for(var c=0,o=0,a=0,p=t[0].length,v=[],s,l,y,h,e;o<r.length;o++){if(e=i._Expression.toString(r[o],u),e.length===0)throw'Invalid Criteria.';e==='*'?v.push(e):v.push(this._parseRightExpr(e))}for(;c<p;c++){s=!1;n:for(o=0;o<t.length;o++)if(y=t[o],h=y[c],e=v[o],typeof e=='string'){if(e!=='*'&&(h==null||h==='')){s=!1;break n}if(s=e==='*'||this.evaluate(this._combineExpr(h,e),null,u),!s)break n}else if(s=s=e.reg.test(h.toString())===e.checkMathces,!s)break n;s&&(f?(l=f[c],l!=null&&n.isNumber(l)&&!isNaN(l)&&a++):a++)}return a},e.prototype._handleSumIfs=function(n,t){var f=1,e=[],o=[],s,r,u,h,c;if(n.length%2!=1)throw'Invalid params.';if(r=n[0],r=this._ensureNonFunctionExpression(r),r instanceof i._CellRangeExpression){if(r.cells)h=r.cells.rowSpan,c=r.cells.columnSpan;else throw'Invalid Sum Cell Reference.';s=this._getItemList([r],t)}else throw'Invalid Sum Cell Reference.';for(;f<(n.length+1)/2;f++)if(u=n[2*f-1],u=this._ensureNonFunctionExpression(u),u instanceof i._CellRangeExpression){if(u.cells){if(u.cells.rowSpan!==h||u.cells.columnSpan!==c)throw'The row span and column span of each cell range has to be same with each other.';}else throw'Invalid Criteria Cell Reference.';e[f-1]=this._getItemList([u],t,!1);o[f-1]=n[2*f]}else throw'Invalid Criteria Cell Reference.';return this._sumCellsByCriterias(e,o,s,t)},e.prototype._sumCellsByCriterias=function(t,r,u,f){var c=0,o=0,v=0,l,p=t[0].length,a=[],s,y,h,e;for(u==null&&(u=t[0]);o<r.length;o++){if(e=i._Expression.toString(r[o],f),e.length===0)throw'Invalid Criteria.';e==='*'?a.push(e):a.push(this._parseRightExpr(e))}for(;c<p;c++){s=!1;l=u[c];n:for(o=0;o<t.length;o++)if(y=t[o],h=y[c],e=a[o],typeof e=='string'){if(e!=='*'&&(h==null||h==='')){s=!1;break n}if(s=e==='*'||this.evaluate(this._combineExpr(h,e),null,f),!s)break n}else if(s=e.reg.test(h.toString())===e.checkMathces,!s)break n;s&&n.isNumber(l)&&!isNaN(l)&&(v+=l)}return v},e.prototype._getProductOfNumbers=function(t){var i,r=0,u=1,f=!1;if(t)for(;r<t.length;r++)i=t[r],n.isNumber(i)&&!isNaN(i)&&(u*=i,f=!0);return f?u:0},e.prototype._handleSubtotal=function(t,r){var u,o,e,s=!0;if(u=i._Expression.toNumber(t[0],r),u>=1&&u<=11||u>=101&&u<=111){u>=101&&u<=111&&(s=!1);u=n.asEnum(u,f);o=this._getItemList(t.slice(1),r,!0,!1,s);switch(u){case 2:case 102:return this._countNumberCells(o);case 3:case 103:return o.length;case 6:case 106:return this._getProductOfNumbers(o);case 1:case 101:e=3;break;case 4:case 104:e=4;break;case 5:case 105:e=5;break;case 7:case 107:e=7;break;case 8:case 108:e=9;break;case 9:case 109:e=1;break;case 10:case 110:e=8;break;case 11:case 111:e=10}return n.getAggregate(e,o)}throw'Invalid Subtotal function.';},e.prototype._handleDCount=function(n,t){var r=n[0],u=n[2],e,o,f;if(r=this._ensureNonFunctionExpression(r),u=this._ensureNonFunctionExpression(u),r instanceof i._CellRangeExpression&&u instanceof i._CellRangeExpression&&(e=n[1].evaluate(t),o=this._getColumnIndexByField(r,e),f=this._getItemList([r],t,!0,!1,!0,o),f&&f.length>1))return this._DCountWithCriterias(f.slice(1),r,u);throw'Invalid Count Cell Reference.';},e.prototype._DCountWithCriterias=function(n,t,r){var u=r.cells,v=0,h,c,y,e,f,p,o,w,s,l,a;if(h=this._getSheet(t.sheetRef),c=this._getSheet(r.sheetRef),u.rowSpan>1){for(y=u.topRow,e=u.bottomRow;e>u.topRow;e--){for(l=[],a=[],f=u.leftCol;f<=u.rightCol;f++)if(o=this._owner.getCellValue(e,f,!1,c),o!=null&&o!=='')if(a.push(new i._Expression(o)),w=this._owner.getCellValue(y,f,!1,c),p=this._getColumnIndexByField(t,w),s=this._getItemList([t],h,!1,!1,!0,p),s!=null&&s.length>1)l.push(s.slice(1));else throw'Invalid Count Cell Reference.';v+=this._countCellsByCriterias(l,a,h,n)}return v}throw'Invalid Criteria Cell Reference.';},e.prototype._getColumnIndexByField=function(t,i){var r,o,f,u,e;if(r=t.cells,e=r.topRow,e===-1)throw'Invalid Count Cell Reference.';if(n.isInt(i)&&!isNaN(i)){if(i>=1&&i<=r.columnSpan)return r.leftCol+i-1}else for(o=this._getSheet(t.sheetRef),f=r.leftCol;f<=r.rightCol;f++)if(u=this._owner.getCellValue(e,f,!1,o),i=n.isString(i)?i.toLowerCase():i,u=n.isString(u)?u.toLowerCase():u,i===u)return f;throw'Invalid field.';},e.prototype._getSheet=function(n){var t=0,i;if(n)for(;t<this._owner.sheets.length;t++)if(i=this._owner.sheets[t],i.name===n)break;return i},e.prototype._parseRightExpr=function(n){var t,r,i=!1;if(n.indexOf('?')>-1||n.indexOf('*')>-1){if(t=n.match(/([\?\*]*)(\w+)([\?\*]*)(\w+)([\?\*]*)/),t!=null&&t.length===6)r=new RegExp('^'+(t[1].length>0?this._parseRegCriteria(t[1]):'')+t[2]+(t[3].length>0?this._parseRegCriteria(t[3]):'')+t[4]+(t[5].length>0?this._parseRegCriteria(t[5]):'')+'$','i');else throw'Invalid Criteria.';return/^[<>=]/.test(n)?n.trim()[0]==='='&&(i=!0):i=!0,{reg:r,checkMathces:i}}if(isNaN(+n))if(/^\w/.test(n))n='="'+n+'"';else if(/^[<>=]{1,2}\s*-?\w+$/.test(n))n=n.replace(/([<>=]{1,2})\s*(-?\w+)/,'$1"$2"');else throw'Invalid Criteria.';else n='='+n;return n},e.prototype._combineExpr=function(t,i){return n.isString(t)&&(t='"'+t+'"'),t='='+t,t+i},e.prototype._parseRegCriteria=function(n){for(var i=0,t=0,r='';i<n.length;i++)n[i]==='*'?(t>0&&(r+='\\w{'+t+'}',t=0),r+='\\w*'):n[i]==='?'&&t++;return t>0&&(r+='\\w{'+t+'}'),r},e.prototype._calculateRate=function(n,t){var v=1e-7,w=20,p=0,b=0,y,r,u,e,o,s,c,k,a,f,l,h;for(u=i._Expression.toNumber(n[0],t),e=i._Expression.toNumber(n[1],t),o=i._Expression.toNumber(n[2],t),s=n[3]!=null?i._Expression.toNumber(n[3],t):0,c=n[4]!=null?i._Expression.toNumber(n[4],t):0,k=n[5]!=null?i._Expression.toNumber(n[5],t):.1,r=k,Math.abs(r)<v?a=o*(1+u*r)+e*(1+r*c)*u+s:(f=Math.exp(u*Math.log(1+r)),a=o*f+e*(1/r+c)*(f-1)+s),l=o+e*u+s,h=o*f+e*(1/r+c)*(f-1)+s,y=r;Math.abs(l-h)>v&&p<w;)r=(h*b-l*y)/(h-l),b=y,y=r,Math.abs(r)<v?a=o*(1+u*r)+e*(1+r*c)*u+s:(f=Math.exp(u*Math.log(1+r)),a=o*f+e*(1/r+c)*(f-1)+s),l=h,h=a,++p;if(Math.abs(l-h)>v&&p===w)throw'It is not able to calculate the rate with current parameters.';return r},e.prototype._handleHLookup=function(n,t){var f=n[0].evaluate(t),e=n[1],o=i._Expression.toNumber(n[2],t),s=n[3]!=null?i._Expression.toBoolean(n[3],t):!0,r,u;if(f==null||f=='')throw'Invalid lookup value.';if(isNaN(o)||o<0)throw'Invalid row index.';if(e=this._ensureNonFunctionExpression(e),e instanceof i._CellRangeExpression){if(r=e.cells,o>r.rowSpan)throw'Row index is out of the cell range.';if(s?(u=this._exactMatch(f,r,t,!1),u===-1&&(u=this._approximateMatch(f,r,t))):u=this._exactMatch(f,r,t),u===-1)throw'Lookup Value is not found.';return this._owner.getCellValue(r.topRow+o-1,u,!1,t)}throw'Invalid Cell Reference.';},e.prototype._exactMatch=function(t,i,r,u){typeof u=="undefined"&&(u=!0);var h=i.topRow,e,o,f,s;if(n.isString(t)&&(t=t.toLowerCase()),u&&n.isString(t)&&(t.indexOf('?')>-1||t.indexOf('*')>-1))if(f=t.match(/([\?\*]*)(\w+)([\?\*]*)(\w+)([\?\*]*)/),f!=null&&f.length===6)s=new RegExp('^'+(f[1].length>0?this._parseRegCriteria(f[1]):'')+f[2]+(f[3].length>0?this._parseRegCriteria(f[3]):'')+f[4]+(f[5].length>0?this._parseRegCriteria(f[5]):'')+'$','i');else throw'Invalid lookup value.';for(e=i.leftCol;e<=i.rightCol;e++)if(o=this._owner.getCellValue(h,e,!1,r),s!=null){if(s.test(o))return e}else if(n.isString(o)&&(o=o.toLowerCase()),t===o)return e;return-1},e.prototype._approximateMatch=function(t,i,r){var u,f,s=i.topRow,e=[],o=0;for(n.isString(t)&&(t=t.toLowerCase()),f=i.leftCol;f<=i.rightCol;f++)u=this._owner.getCellValue(s,f,!1,r),u=isNaN(+u)?u:+u,e.push({value:u,index:f});for(e.sort(function(t,i){return(n.isString(t.value)&&(t.value=t.value.toLowerCase()),n.isString(i.value)&&(i.value=i.value.toLowerCase()),t.value>i.value)?-1:t.value===i.value?i.index-t.index:1});o<e.length;o++)if(u=e[o],n.isString(u.value)&&(u.value=u.value.toLowerCase()),t>u.value)return u.index;throw'Lookup Value is not found.';},e.prototype._checkCache=function(n){var t=this._expressionCache[n];return t?t:(t=this._parse(n),this._cacheSize>1e4&&(this._expressionCache=null,this._expressionCache={},this._cacheSize=0),this._expressionCache[n]=t,this._cacheSize++,t)},e.prototype._ensureNonFunctionExpression=function(n,t){while(n instanceof i._FunctionExpression)n=n.evaluate(t);return n},e}(),u,r,s,h,e,f;i._CalcEngine=o;u=function(){function n(n,t,i){this._value=n;this._tokenID=t;this._tokenType=i}return Object.defineProperty(n.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"tokenID",{get:function(){return this._tokenID},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"tokenType",{get:function(){return this._tokenType},enumerable:!0,configurable:!0}),n}();i._Token=u;r=function(){function t(t,i,r){this._paramMax=Number.MAX_VALUE;this._paramMin=Number.MIN_VALUE;this._func=t;n.isNumber(i)&&!isNaN(i)&&(this._paramMax=i);n.isNumber(r)&&!isNaN(r)&&(this._paramMin=r)}return Object.defineProperty(t.prototype,"paramMax",{get:function(){return this._paramMax},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMin",{get:function(){return this._paramMin},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"func",{get:function(){return this._func},enumerable:!0,configurable:!0}),t}();i._FunctionDefinition=r,function(n){n[n.COMPARE=0]="COMPARE";n[n.ADDSUB=1]="ADDSUB";n[n.MULDIV=2]="MULDIV";n[n.POWER=3]="POWER";n[n.CONCAT=4]="CONCAT";n[n.GROUP=5]="GROUP";n[n.LITERAL=6]="LITERAL";n[n.IDENTIFIER=7]="IDENTIFIER"}(i._TokenType||(i._TokenType={}));s=i._TokenType,function(n){n[n.GT=0]="GT";n[n.LT=1]="LT";n[n.GE=2]="GE";n[n.LE=3]="LE";n[n.EQ=4]="EQ";n[n.NE=5]="NE";n[n.ADD=6]="ADD";n[n.SUB=7]="SUB";n[n.MUL=8]="MUL";n[n.DIV=9]="DIV";n[n.DIVINT=10]="DIVINT";n[n.MOD=11]="MOD";n[n.POWER=12]="POWER";n[n.CONCAT=13]="CONCAT";n[n.OPEN=14]="OPEN";n[n.CLOSE=15]="CLOSE";n[n.END=16]="END";n[n.COMMA=17]="COMMA";n[n.PERIOD=18]="PERIOD";n[n.ATOM=19]="ATOM"}(i._TokenID||(i._TokenID={}));h=i._TokenID,function(n){n[n.Count=0]="Count";n[n.CountA=1]="CountA";n[n.ConutBlank=2]="ConutBlank";n[n.CountIf=3]="CountIf";n[n.CountIfs=4]="CountIfs";n[n.Rank=5]="Rank";n[n.SumIf=6]="SumIf";n[n.SumIfs=7]="SumIfs";n[n.Product=8]="Product"}(e||(e={})),function(n){n[n.Average=1]="Average";n[n.Count=2]="Count";n[n.CountA=3]="CountA";n[n.Max=4]="Max";n[n.Min=5]="Min";n[n.Product=6]="Product";n[n.Std=7]="Std";n[n.StdPop=8]="StdPop";n[n.Sum=9]="Sum";n[n.Var=10]="Var";n[n.VarPop=11]="VarPop";n[n.AverageWithoutHidden=101]="AverageWithoutHidden";n[n.CountWithoutHidden=102]="CountWithoutHidden";n[n.CountAWithoutHidden=103]="CountAWithoutHidden";n[n.MaxWithoutHidden=104]="MaxWithoutHidden";n[n.MinWithoutHidden=105]="MinWithoutHidden";n[n.ProductWithoutHidden=106]="ProductWithoutHidden";n[n.StdWithoutHidden=107]="StdWithoutHidden";n[n.StdPopWithoutHidden=108]="StdPopWithoutHidden";n[n.SumWithoutHidden=109]="SumWithoutHidden";n[n.VarWithoutHidden=110]="VarWithoutHidden";n[n.VarPopWithoutHidden=111]="VarPopWithoutHidden"}(f||(f={}))})(t.sheet||(t.sheet={}));var i=t.sheet})(n.grid||(n.grid={}));var t=n.grid})(wijmo||(wijmo={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){(function(t){(function(i){'use strict';var r=function(){function t(n){this._token=n?n instanceof i._Token?n:new i._Token(n,19,6):new i._Token(null,19,7)}return Object.defineProperty(t.prototype,"token",{get:function(){return this._token},enumerable:!0,configurable:!0}),t.prototype.evaluate=function(){if(this._token.tokenType!==6)throw'Bad expression.';return this._token.value},t.toString=function(t,i){var r=t.evaluate(i);return n.isPrimitive(r)||(r=r.value),r!=null?r.toString():''},t.toNumber=function(t,i){var r=t.evaluate(i);return(n.isPrimitive(r)||(r=r.value),n.isNumber(r))?r:n.isBoolean(r)?r?1:0:n.isDate(r)?this._toOADate(r):n.isString(r)?r?+r:0:n.changeType(r,2,'')},t.toBoolean=function(t,i){var r=t.evaluate(i);return(n.isPrimitive(r)||(r=r.value),n.isBoolean(r))?r:n.isNumber(r)?r===0?!1:!0:n.changeType(r,3,'')},t.toDate=function(t,i){var r=t.evaluate(i);return(n.isPrimitive(r)||(r=r.value),n.isDate(r))?r:n.isNumber(r)?this._fromOADate(r):n.changeType(r,4,'')},t._toOADate=function(n){var t=Date.UTC(1899,11,30),i=Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds());return(i-t)/864e5},t._fromOADate=function(n){var t=Date.UTC(1899,11,30);return new Date(n*864e5+t)},t}(),u,f,e,o;i._Expression=r;u=function(n){function t(t,i){n.call(this,t);this._expr=i}return __extends(t,n),t.prototype.evaluate=function(n){if(this.token.tokenID===7)return this._evaluatedValue==null&&(this._evaluatedValue=-r.toNumber(this._expr,n)),this._evaluatedValue;if(this.token.tokenID===6)return this._evaluatedValue==null&&(this._evaluatedValue=+r.toNumber(this._expr,n)),this._evaluatedValue;throw'Bad expression.';},t}(r);i._UnaryExpression=u;f=function(n){function t(t,i,r){n.call(this,t);this._leftExpr=i;this._rightExpr=r}return __extends(t,n),t.prototype.evaluate=function(n){var f,e,t,i,u;if(this._evaluatedValue!=null)return this._evaluatedValue;if(f=r.toString(this._leftExpr,n),e=r.toString(this._rightExpr,n),this.token.tokenType===4)return this._evaluatedValue=f+e,this._evaluatedValue;if(t=r.toNumber(this._leftExpr,n),i=r.toNumber(this._rightExpr,n),u=t-i,this.token.tokenType===0)switch(this.token.tokenID){case 0:return u>0;case 1:return u<0;case 2:return u>=0;case 3:return u<=0;case 4:return isNaN(u)?(this._evaluatedValue=f.toLowerCase()===e.toLowerCase(),this._evaluatedValue):(this._evaluatedValue=u===0,this._evaluatedValue);case 5:return isNaN(u)?(this._evaluatedValue=f.toLowerCase()!==e.toLowerCase(),this._evaluatedValue):(this._evaluatedValue=u!==0,this._evaluatedValue)}switch(this.token.tokenID){case 6:this._evaluatedValue=t+i;break;case 7:this._evaluatedValue=t-i;break;case 8:this._evaluatedValue=t*i;break;case 9:this._evaluatedValue=t/i;break;case 10:this._evaluatedValue=Math.floor(t/i);break;case 11:this._evaluatedValue=Math.floor(t%i);break;case 12:i===0&&(this._evaluatedValue=1);i===.5&&(this._evaluatedValue=Math.sqrt(t));i===1&&(this._evaluatedValue=t);i===2&&(this._evaluatedValue=t*t);i===3&&(this._evaluatedValue=t*t*t);i===4&&(this._evaluatedValue=t*t*t*t);this._evaluatedValue=Math.pow(t,i);break;default:this._evaluatedValue=NaN}if(!isNaN(this._evaluatedValue))return this._evaluatedValue;throw'Bad expression.';},t}(r);i._BinaryExpression=f;e=function(i){function r(n,t,r){i.call(this);this._cells=n;this._sheetRef=t;this._flex=r;this._evalutingRange={}}return __extends(r,i),r.prototype.evaluate=function(n){return this._evaluatedValue==null&&(this._evaluatedValue=this._getCellValue(this._cells,n)),this._evaluatedValue},r.prototype.getValues=function(i,r,u){typeof i=="undefined"&&(i=!0);var e,o=[],s=0,f,r,h,c;for(h=r!=null&&!isNaN(+r)?r:this._cells.leftCol,c=r!=null&&!isNaN(+r)?r:this._cells.rightCol,u=u||this._getSheet()||this._flex.selectedSheet,f=this._cells.topRow;f<=this._cells.bottomRow;f++){if(f>=u.grid.rows.length)throw'The cell reference is out of the cell range of the flexsheet.';if(i||u.grid.rows[f].isVisible!==!1)for(r=h;r<=c;r++){if(r>=u.grid.columns.length)throw'The cell reference is out of the cell range of the flexsheet.';(i||u.grid.columns[r].isVisible!==!1)&&(e=this._getCellValue(new t.CellRange(f,r),u),n.isPrimitive(e)||(e=e.value),o[s]=e,s++)}}return o},Object.defineProperty(r.prototype,"cells",{get:function(){return this._cells},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"sheetRef",{get:function(){return this._sheetRef},enumerable:!0,configurable:!0}),r.prototype._getCellValue=function(n,t){var t,i;if(t=t||this._getSheet()||this._flex.selectedSheet,i=t.name+':'+n.row+','+n.col+'-'+n.row2+','+n.col2,this._evalutingRange[i])throw'Circular Reference';try{if(this._flex)return this._evalutingRange[i]=!0,this._flex.getCellValue(n.row,n.col,!1,t)}finally{delete this._evalutingRange[i]}},r.prototype._getSheet=function(){var n=0,t;if(!this._sheetRef)return null;for(;n<this._flex.sheets.length;n++)if(t=this._flex.sheets[n],t.name===this._sheetRef)return t;throw'Invalid sheet reference';},r}(r);i._CellRangeExpression=e;o=function(n){function t(t,i){n.call(this);this._funcDefinition=t;this._params=i}return __extends(t,n),t.prototype.evaluate=function(n,t,i){return this._evaluatedValue==null&&(this._evaluatedValue=this._funcDefinition.func(this._params,n,t,i)),this._evaluatedValue},t}(r);i._FunctionExpression=o})(t.sheet||(t.sheet={}));var i=t.sheet})(n.grid||(n.grid={}));var t=n.grid}(wijmo||(wijmo={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){(function(n){(function(n){'use strict';var t=function(){function n(n){this._owner=n;this._sheetIndex=n.selectedSheetIndex}return Object.defineProperty(n.prototype,"sheetIndex",{get:function(){return this._sheetIndex},enumerable:!0,configurable:!0}),n.prototype.undo=function(){throw'This abstract method must be overrided.';},n.prototype.redo=function(){throw'This abstract method must be overrided.';},n.prototype.saveNewState=function(){throw'This abstract method must be overrided.';},n}(),i,r,u,f,e,o,s,h,c;n._UndoAction=t;i=function(n){function t(t){var u,i,r;for(n.call(this,t),this._isPaste=!1,this._selection=t.selection,this._oldValues=[],u=t.selection.topRow;u<=t.selection.bottomRow;u++)for(i=t.selection.leftCol;i<=t.selection.rightCol;i++)r=t.getCellData(u,i,!!t.columns[i].dataMap),r=r==undefined?'':r,this._oldValues.push(r)}return __extends(t,n),Object.defineProperty(t.prototype,"isPaste",{get:function(){return this._isPaste},enumerable:!0,configurable:!0}),t.prototype.undo=function(){for(var i=0,t,n=this._selection.topRow;n<=this._selection.bottomRow;n++)for(t=this._selection.leftCol;t<=this._selection.rightCol;t++)this._owner.setCellData(n,t,this._oldValues[i]),i++;this._owner.select(this._selection);this._owner.refresh(!1)},t.prototype.redo=function(){for(var i=0,t,n=this._selection.topRow;n<=this._selection.bottomRow;n++)for(t=this._selection.leftCol;t<=this._selection.rightCol;t++)this._owner.setCellData(n,t,this._newValues[i]),i++;this._owner.select(this._selection);this._owner.refresh(!1)},t.prototype.saveNewState=function(){var r,i,n,t;for(this._newValues=[],this._selection=this._owner.selection,i=this._selection.topRow;i<=this._selection.bottomRow;i++)for(n=this._selection.leftCol;n<=this._selection.rightCol;n++){if(r=this._owner.columns[n],!r)return!1;t=this._owner.getCellData(i,n,!!r.dataMap);t=t==undefined?'':t;this._newValues.push(t)}return!this._checkActionState()},t.prototype.markIsPaste=function(){this._isPaste=!0},t.prototype.resetEditAction=function(n){var t;this._addingValue||(this._addingValue=!0,this._oldValues=[]);t=this._owner.getCellData(n.row,n.col,!!this._owner.columns[n.col].dataMap);t=t==undefined?'':t;this._oldValues.push(t)},t.prototype._checkActionState=function(){var n;if(this._oldValues.length!==this._newValues.length)return!1;for(n=0;n<this._oldValues.length;n++)if(this._oldValues[n]!==this._newValues[n])return!1;return!0},t}(t);n._EditAction=i;r=function(n){function t(t,i){n.call(this,t);this._colIndex=i;this._oldColWidth=t.columns[i].width}return __extends(t,n),t.prototype.undo=function(){this._owner.columns[this._colIndex].width=this._oldColWidth},t.prototype.redo=function(){this._owner.columns[this._colIndex].width=this._newColWidth},t.prototype.saveNewState=function(){return(this._newColWidth=this._owner.columns[this._colIndex].width,this._oldColWidth===this._newColWidth)?!1:!0},t}(t);n._ColumnResizeAction=r;u=function(n){function t(t,i){n.call(this,t);this._rowIndex=i;this._oldRowHeight=t.rows[i].height}return __extends(t,n),t.prototype.undo=function(){this._owner.rows[this._rowIndex].height=this._oldRowHeight},t.prototype.redo=function(){this._owner.rows[this._rowIndex].height=this._newRowHeight},t.prototype.saveNewState=function(){return(this._newRowHeight=this._owner.rows[this._rowIndex].height,this._oldRowHeight===this._newRowHeight)?!1:!0},t}(t);n._RowResizeAction=u;f=function(n){function t(t){var i,r=[];for(n.call(this,t),i=0;i<t.columns.length;i++)r.push(t.columns[i]);this._oldValue={columns:r,sortList:t.sortManager._committedList.slice(),styledCells:JSON.parse(JSON.stringify(t.selectedSheet._styledCells)),mergedCells:t._cloneMergedCells()}}return __extends(t,n),t.prototype.undo=function(){var n;for(this._owner.columns.clear(),this._owner.selectedSheet._styledCells=undefined,this._owner.selectedSheet._mergedRanges=undefined,this._owner.columns.beginUpdate(),n=0;n<this._oldValue.columns.length;n++)this._owner.columns.push(this._oldValue.columns[n]);this._owner.columns.endUpdate();this._owner.selectedSheet._styledCells=this._oldValue.styledCells;this._owner.selectedSheet._mergedRanges=this._oldValue.mergedCells;this._owner._copyTo(this._owner.selectedSheet);this._owner.selectedSheet.grid.wj_sheetInfo.styledCells=this._owner.selectedSheet._styledCells;this._owner.selectedSheet.grid.wj_sheetInfo.mergedRanges=this._owner.selectedSheet._mergedRanges;this._owner.sortManager.sortDescriptions.sourceCollection=this._oldValue.sortList.slice();this._owner.sortManager.commitSort(!1);this._owner.sortManager._refresh();this._owner.refresh(!0)},t.prototype.redo=function(){var n;for(this._owner.columns.clear(),this._owner.selectedSheet._styledCells=undefined,this._owner.selectedSheet._mergedRanges=undefined,this._owner.columns.beginUpdate(),n=0;n<this._newValue.columns.length;n++)this._owner.columns.push(this._newValue.columns[n]);this._owner.columns.endUpdate();this._owner.selectedSheet._styledCells=this._newValue.styledCells;this._owner.selectedSheet._mergedRanges=this._newValue.mergedCells;this._owner._copyTo(this._owner.selectedSheet);this._owner.selectedSheet.grid.wj_sheetInfo.styledCells=this._owner.selectedSheet._styledCells;this._owner.selectedSheet.grid.wj_sheetInfo.mergedRanges=this._owner.selectedSheet._mergedRanges;this._owner.sortManager.sortDescriptions.sourceCollection=this._newValue.sortList.slice();this._owner.sortManager.commitSort(!1);this._owner.sortManager._refresh();this._owner.refresh(!0)},t.prototype.saveNewState=function(){for(var t=[],n=0;n<this._owner.columns.length;n++)t.push(this._owner.columns[n]);return this._newValue={columns:t,sortList:this._owner.sortManager._committedList.slice(),styledCells:JSON.parse(JSON.stringify(this._owner.selectedSheet._styledCells)),mergedCells:this._owner._cloneMergedCells()},!0},t}(t);n._ColumnsChangedAction=f;e=function(t){function i(n){var i,r,u=[],f=[];for(t.call(this,n),i=0;i<n.rows.length;i++)u.push(n.rows[i]);for(r=0;r<n.columns.length;r++)f.push(n.columns[r]);this._oldValue={rows:u,columns:f,itemsSource:n.itemsSource?n.itemsSource.slice():undefined,styledCells:JSON.parse(JSON.stringify(n.selectedSheet._styledCells)),mergedCells:n._cloneMergedCells()}}return __extends(i,t),i.prototype.undo=function(){var t,r,i,u=!!this._oldValue.itemsSource;for(this._owner.finishEditing(),this._owner.columns.clear(),this._owner.rows.clear(),this._owner.selectedSheet._styledCells=undefined,this._owner.selectedSheet._mergedRanges=undefined,u&&(this._owner.autoGenerateColumns=!1,this._owner.itemsSource=this._oldValue.itemsSource.slice()),this._owner.rows.beginUpdate(),t=0;t<this._oldValue.rows.length;t++)i=this._oldValue.rows[t],u?i.dataItem||i instanceof n.HeaderRow||this._owner.rows.splice(t,0,i):this._owner.rows.push(i);for(r=0;r<this._oldValue.columns.length;r++)this._owner.columns.push(this._oldValue.columns[r]);this._owner.rows.endUpdate();this._owner.selectedSheet._styledCells=this._oldValue.styledCells;this._owner.selectedSheet._mergedRanges=this._oldValue.mergedCells;this._owner._copyTo(this._owner.selectedSheet);this._owner.selectedSheet.grid.wj_sheetInfo.styledCells=this._owner.selectedSheet._styledCells;this._owner.selectedSheet.grid.wj_sheetInfo.mergedRanges=this._owner.selectedSheet._mergedRanges;this._owner.refresh(!0)},i.prototype.redo=function(){var t,r,i,u=!!this._newValue.itemsSource;for(this._owner.finishEditing(),this._owner.columns.clear(),this._owner.rows.clear(),this._owner.selectedSheet._styledCells=undefined,this._owner.selectedSheet._mergedRanges=undefined,u&&(this._owner.autoGenerateColumns=!1,this._owner.itemsSource=this._newValue.itemsSource.slice()),this._owner.rows.beginUpdate(),t=0;t<this._newValue.rows.length;t++)i=this._newValue.rows[t],u?i.dataItem||i instanceof n.HeaderRow||this._owner.rows.splice(t,0,i):this._owner.rows.push(i);for(r=0;r<this._newValue.columns.length;r++)this._owner.columns.push(this._newValue.columns[r]);this._owner.rows.endUpdate();this._owner.selectedSheet._styledCells=this._newValue.styledCells;this._owner.selectedSheet._mergedRanges=this._newValue.mergedCells;this._owner._copyTo(this._owner.selectedSheet);this._owner.selectedSheet.grid.wj_sheetInfo.styledCells=this._owner.selectedSheet._styledCells;this._owner.selectedSheet.grid.wj_sheetInfo.mergedRanges=this._owner.selectedSheet._mergedRanges;this._owner.refresh(!0)},i.prototype.saveNewState=function(){for(var t,i=[],r=[],n=0;n<this._owner.rows.length;n++)i.push(this._owner.rows[n]);for(t=0;t<this._owner.columns.length;t++)r.push(this._owner.columns[t]);return this._newValue={rows:i,columns:r,itemsSource:this._owner.itemsSource?this._owner.itemsSource.slice():undefined,styledCells:JSON.parse(JSON.stringify(this._owner.selectedSheet._styledCells)),mergedCells:this._owner._cloneMergedCells()},!0},i}(t);n._RowsChangedAction=e;o=function(n){function t(t,i){n.call(this,t);this._oldStyledCells=i?JSON.parse(JSON.stringify(i)):JSON.parse(JSON.stringify(t.selectedSheet._styledCells))}return __extends(t,n),t.prototype.undo=function(){this._owner.selectedSheet._styledCells=JSON.parse(JSON.stringify(this._oldStyledCells));this._owner.selectedSheet.grid.wj_sheetInfo.styledCells=this._owner.selectedSheet._styledCells;this._owner.refresh(!0)},t.prototype.redo=function(){this._owner.selectedSheet._styledCells=JSON.parse(JSON.stringify(this._newStyledCells));this._owner.selectedSheet.grid.wj_sheetInfo.styledCells=this._owner.selectedSheet._styledCells;this._owner.refresh(!0)},t.prototype.saveNewState=function(){return this._newStyledCells=JSON.parse(JSON.stringify(this._owner.selectedSheet._styledCells)),!0},t}(t);n._CellStyleAction=o;s=function(n){function t(t){n.call(this,t);this._oldMergedCells=t._cloneMergedCells()}return __extends(t,n),t.prototype.undo=function(){this._owner.selectedSheet._mergedRanges=this._oldMergedCells;this._owner.selectedSheet.grid.wj_sheetInfo.mergedRanges=this._owner.selectedSheet._mergedRanges;this._owner.refresh(!0)},t.prototype.redo=function(){this._owner.selectedSheet._mergedRanges=this._newMergedCells;this._owner.selectedSheet.grid.wj_sheetInfo.mergedRanges=this._owner.selectedSheet._mergedRanges;this._owner.refresh(!0)},t.prototype.saveNewState=function(){return this._newMergedCells=this._owner._cloneMergedCells(),!0},t}(t);n._CellMergeAction=s;h=function(n){function t(t){var i,r,u=[],f=[];if(n.call(this,t),!t.itemsSource){for(i=0;i<t.rows.length;i++)f.push(t.rows[i]);for(r=0;r<t.columns.length;r++)u.push(t.columns[r])}this._oldValue={sortList:t.sortManager._committedList.slice(),rows:f,columns:u}}return __extends(t,n),t.prototype.undo=function(){var n,t;if(this._owner.sortManager.sortDescriptions.sourceCollection=this._oldValue.sortList.slice(),this._owner.sortManager.commitSort(!1),this._owner.sortManager._refresh(),!this._owner.itemsSource){for(this._owner.rows.clear(),this._owner.columns.clear(),this._owner.selectedSheet.grid.rows.clear(),this._owner.selectedSheet.grid.columns.clear(),n=0;n<this._oldValue.rows.length;n++)this._owner.rows.push(this._oldValue.rows[n]),this._owner.selectedSheet.grid.rows.push(this._oldValue.rows[n]);for(t=0;t<this._oldValue.columns.length;t++)this._owner.columns.push(this._oldValue.columns[t]),this._owner.selectedSheet.grid.columns.push(this._oldValue.columns[t])}},t.prototype.redo=function(){var n,t;if(this._owner.sortManager.sortDescriptions.sourceCollection=this._newValue.sortList.slice(),this._owner.sortManager.commitSort(!1),this._owner.sortManager._refresh(),!this._owner.itemsSource){for(this._owner.rows.clear(),this._owner.columns.clear(),this._owner.selectedSheet.grid.rows.clear(),this._owner.selectedSheet.grid.columns.clear(),n=0;n<this._newValue.rows.length;n++)this._owner.rows.push(this._newValue.rows[n]),this._owner.selectedSheet.grid.rows.push(this._newValue.rows[n]);for(t=0;t<this._newValue.columns.length;t++)this._owner.columns.push(this._newValue.columns[t]),this._owner.selectedSheet.grid.columns.push(this._newValue.columns[t])}},t.prototype.saveNewState=function(){var n,t,i=[],r=[];if(!this._owner.itemsSource){for(n=0;n<this._owner.rows.length;n++)r.push(this._owner.rows[n]);for(t=0;t<this._owner.columns.length;t++)i.push(this._owner.columns[t])}return this._newValue={sortList:this._owner.sortManager._committedList.slice(),rows:r,columns:i},!0},t}(t);n._SortColumnAction=h;c=function(n){function t(t,i,r,u){var f,e,o,s,h;for(n.call(this,t),this._isCopyCells=u,this._dropRange=r,this._oldDroppingCells=[],f=r.topRow;f<=r.bottomRow;f++)for(e=r.leftCol;e<=r.rightCol;e++)o=f*this._owner.columns.length+e,h=this._owner.selectedSheet._styledCells[o]?JSON.parse(JSON.stringify(this._owner.selectedSheet._styledCells[o])):undefined,s=this._owner.getCellData(f,e,!1),this._oldDroppingCells.push({rowIndex:f,columnIndex:e,cellContent:s,cellStyle:h});if(!u)for(this._draggingCells=[],f=i.topRow;f<=i.bottomRow;f++)for(e=i.leftCol;e<=i.rightCol;e++)o=f*this._owner.columns.length+e,h=this._owner.selectedSheet._styledCells[o]?JSON.parse(JSON.stringify(this._owner.selectedSheet._styledCells[o])):undefined,s=this._owner.getCellData(f,e,!1),this._draggingCells.push({rowIndex:f,columnIndex:e,cellContent:s,cellStyle:h})}return __extends(t,n),t.prototype.undo=function(){for(var n,i,t=0;t<this._oldDroppingCells.length;t++)n=this._oldDroppingCells[t],this._owner.setCellData(n.rowIndex,n.columnIndex,n.cellContent),i=n.rowIndex*this._owner.columns.length+n.columnIndex,n.cellStyle?this._owner.selectedSheet._styledCells[i]=n.cellStyle:delete this._owner.selectedSheet._styledCells[i];if(!this._isCopyCells)for(t=0;t<this._draggingCells.length;t++)n=this._draggingCells[t],this._owner.setCellData(n.rowIndex,n.columnIndex,n.cellContent),i=n.rowIndex*this._owner.columns.length+n.columnIndex,n.cellStyle&&(this._owner.selectedSheet._styledCells[i]=n.cellStyle)},t.prototype.redo=function(){for(var n,i,t=0;t<this._newDroppingCells.length;t++)n=this._newDroppingCells[t],this._owner.setCellData(n.rowIndex,n.columnIndex,n.cellContent),i=n.rowIndex*this._owner.columns.length+n.columnIndex,n.cellStyle?this._owner.selectedSheet._styledCells[i]=n.cellStyle:delete this._owner.selectedSheet._styledCells[i];if(!this._isCopyCells)for(t=0;t<this._draggingCells.length;t++)n=this._draggingCells[t],this._owner.setCellData(n.rowIndex,n.columnIndex,undefined),i=n.rowIndex*this._owner.columns.length+n.columnIndex,this._owner.selectedSheet._styledCells[i]&&delete this._owner.selectedSheet._styledCells[i]},t.prototype.saveNewState=function(){var n,t,i,r,u;if(this._dropRange){for(this._newDroppingCells=[],n=this._dropRange.topRow;n<=this._dropRange.bottomRow;n++)for(t=this._dropRange.leftCol;t<=this._dropRange.rightCol;t++)i=n*this._owner.columns.length+t,u=this._owner.selectedSheet._styledCells[i]?JSON.parse(JSON.stringify(this._owner.selectedSheet._styledCells[i])):undefined,r=this._owner.getCellData(n,t,!1),this._newDroppingCells.push({rowIndex:n,columnIndex:t,cellContent:r,cellStyle:u});return!0}return!1},t}(t);n._MoveCellsAction=c})(n.sheet||(n.sheet={}));var t=n.sheet})(n.grid||(n.grid={}));var t=n.grid}(wijmo||(wijmo={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){(function(t){(function(t){'use strict';var i=function(n){function t(t,i){n.call(this,t);this._owner=i;this.applyTemplate('',this.getTemplate(),{_insRows:'insert-rows',_delRows:'delete-rows',_insCols:'insert-columns',_delCols:'delete-columns'});this._init()}return __extends(t,n),t.prototype.show=function(n,t){var i=(t?t.x:n.clientX)+(n?window.pageXOffset:0),r=(t?t.y:n.clientY)+(n?window.pageYOffset:0);this.hostElement.style.position='absolute';this.hostElement.style.display='inline';r+this.hostElement.clientHeight>window.innerHeight&&(r-=this.hostElement.clientHeight);i+this.hostElement.clientWidth>window.innerWidth&&(i-=this.hostElement.clientWidth);this.hostElement.style.top=r+'px';this.hostElement.style.left=i+'px'},t.prototype.hide=function(){this.hostElement.style.display='none'},t.prototype._init=function(){var n=this;document.querySelector('body').appendChild(n.hostElement);n.addEventListener(n.hostElement,'contextmenu',function(n){n.preventDefault()});n.addEventListener(n._insRows,'click',function(){n._owner.insertRows();n.hide()});n.addEventListener(n._delRows,'click',function(){n._owner.deleteRows();n.hide()});n.addEventListener(n._insCols,'click',function(){n._owner.insertColumns();n.hide()});n.addEventListener(n._delCols,'click',function(){n._owner.deleteColumns();n.hide()})},t.controlTemplate='<div class="wj-context-menu" width="150px"><div class="wj-context-menu-item" wj-part="insert-rows">Insert Row<\/div><div class="wj-context-menu-item" wj-part="delete-rows">Delete Rows<\/div><div class="wj-context-menu-item" wj-part="insert-columns">Insert Column<\/div><div class="wj-context-menu-item" wj-part="delete-columns">Delete Columns<\/div><\/div>',t}(n.Control);t._ContextMenu=i})(t.sheet||(t.sheet={}));var i=t.sheet})(n.grid||(n.grid={}));var t=n.grid}(wijmo||(wijmo={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){(function(t){(function(t){'use strict';var i=function(n){function i(t,i){n.call(this,t);this._splitterMousedownHdl=this._splitterMousedownHandler.bind(this);this._owner=i;this.hostElement.attributes.tabindex&&this.hostElement.attributes.removeNamedItem('tabindex');this.applyTemplate('',this.getTemplate(),{_divSheet:'left',_divSplitter:'splitter',_divRight:'right'});this._init()}return __extends(i,n),Object.defineProperty(i.prototype,"sheetControl",{get:function(){return this._sheetControl},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visible",{get:function(){return this.hostElement.style.display!=='none'},set:function(n){this.hostElement.style.display=n?'block':'none';this._divSheet.style.display=n?'block':'none'},enumerable:!0,configurable:!0}),i.prototype.getSheetBlanketSize=function(){return 20},i.prototype.adjustSize=function(){var t=this._owner.scrollSize.width-this._owner.clientSize.width,i=this._owner.scrollSize.height-this._owner.clientSize.height,n=this._divSplitter.parentElement;t<=0?(n.style.minWidth='100px',this._divSplitter.style.display='none',this._divRight.style.display='none',this._divSheet.style.width='100%',this._divSplitter.removeEventListener('mousedown',this._splitterMousedownHdl,!0)):(n.style.minWidth='300px',this._divSplitter.style.display='none',this._divRight.style.display='none',this._divSheet.style.width='100%',this._divSplitter.removeEventListener('mousedown',this._splitterMousedownHdl,!0),this._divSplitter.addEventListener('mousedown',this._splitterMousedownHdl,!0))},i.prototype._init=function(){var n=this;n._funSplitterMousedown=function(t){n._splitterMouseupHandler(t)};n._divSplitter.parentElement.style.height=n.getSheetBlanketSize()+'px';n._sheetControl=new t._SheetTabs(n._divSheet,this._owner)},i.prototype._splitterMousedownHandler=function(n){this._startPos=n.pageX;document.addEventListener('mousemove',this._splitterMousemoveHandler.bind(this),!0);document.addEventListener('mouseup',this._funSplitterMousedown,!0);n.preventDefault()},i.prototype._splitterMousemoveHandler=function(n){this._startPos!==null&&typeof this._startPos!='undefined'&&this._adjustDis(n.pageX-this._startPos)},i.prototype._splitterMouseupHandler=function(n){document.removeEventListener('mousemove',this._splitterMousemoveHandler,!0);document.removeEventListener('mouseup',this._funSplitterMousedown,!0);this._adjustDis(n.pageX-this._startPos);this._startPos=null},i.prototype._adjustDis=function(n){var t=this._divRight.offsetWidth-n,i=this._divSheet.offsetWidth+n;(t<=100?(t=100,n=this._divRight.offsetWidth-t,i=this._divSheet.offsetWidth+n):i<=100&&(i=100,n=i-this._divSheet.offsetWidth,t=this._divRight.offsetWidth-n),n!=0)&&(this._divRight.style.width=t+'px',this._divSheet.style.width=i+'px',this._startPos=this._startPos+n)},i.controlTemplate='<div><div wj-part="left" style ="float:left;height:100%;overflow:hidden"><\/div><div wj-part="splitter" style="float:left;height:100%;width:6px;background-color:#e9eaee;padding:2px;cursor:e-resize"><div style="background-color:#8a9eb2;height:100%"><\/div><\/div><div wj-part="right" style="float:left;height:100%;background-color:#e9eaee"><\/div><\/div>',i}(n.Control);t._TabHolder=i})(t.sheet||(t.sheet={}));var i=t.sheet})(n.grid||(n.grid={}));var t=n.grid}(wijmo||(wijmo={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){(function(t){(function(i){'use strict';var r=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.updateCell=function(r,u,f,e,o){var y,p,s,l,a,c,v,w,b,h;r.cellType===1&&this._resetCellStyle(r.columns[f],e);t.prototype.updateCell.call(this,r,u,f,e,o);o&&!o.isSingleCell&&(u=o.row,f=o.col);switch(r.cellType){case 3:e.textContent=u+1+'';break;case 2:y=i.FlexSheet.convertNumberToAlpha(f);e.innerHTML=e.innerHTML.replace(e.textContent,'')+y;e.style.textAlign='center';break;case 1:if(r.rows[u]instanceof i.HeaderRow)e.innerHTML=n.escapeHtml(r.columns[f].header),n.addClass(e,'wj-header-row');else if(s=r.grid,p=u*s.columns.length+f,c=s.selectedSheet&&s.selectedSheet._styledCells?s.selectedSheet._styledCells[p]:null,s.editRange&&s.editRange.contains(u,f)||(r.columns[f].dataType===3?(v=e.querySelector('[type="checkbox"]'),v&&(v.checked=s.getCellValue(u,f))):(l=e.firstChild,a=s.getCellValue(u,f,!0),l&&l.nodeType===3&&l.nodeValue!==a&&(l.nodeValue=a))),c){w=e.style;for(h in c)h==='className'?c.className&&n.addClass(e,c.className+'-style'):h!=='format'&&(b=c[h])&&(w[h]=(n.hasClass(e,'wj-state-selected')||n.hasClass(e,'wj-state-multi-selected'))&&(h==='color'||h==='backgroundColor')?'':b)}}},r.prototype._resetCellStyle=function(n,t){['fontFamily','fontSize','fontStyle','fontWeight','textDecoration','textAlign','verticalAlign','backgroundColor','color'].forEach(function(i){i==='textAlign'?t.style.textAlign=n.getAlignment():t.style[i]=''})},r}(t.CellFactory);i._FlexSheetCellFactory=r})(t.sheet||(t.sheet={}));var i=t.sheet})(n.grid||(n.grid={}));var t=n.grid}(wijmo||(wijmo={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){(function(t){(function(i){'use strict';var e=[{name:'abs',description:'Returns the absolute value of a number.'},{name:'acos',description:'Returns the arccosine of a number.'},{name:'and',description:'Returns TRUE if all of its arguments are TRUE.'},{name:'asin',description:'Returns the arcsine of a number.'},{name:'atan',description:'Returns the arctangent of a number.'},{name:'atan2',description:'Returns the arctangent from x- and y-coordinates.'},{name:'average',description:'Returns the average of its arguments.'},{name:'ceiling',description:'Rounds a number to the nearest integer or to the nearest multiple of significance.'},{name:'char',description:'Returns the character specified by the code number.'},{name:'choose',description:'Chooses a value from a list of values.'},{name:'code',description:'Returns a numeric code for the first character in a text string.'},{name:'column',description:'Returns the column number of a reference.'},{name:'columns',description:'Returns the number of columns in a reference.'},{name:'concatenate',description:'Joins several text items into one text item.'},{name:'cos',description:'Returns the cosine of a number.'},{name:'count',description:'Counts how many numbers are in the list of arguments.'},{name:'counta',description:'Counts how many values are in the list of arguments.'},{name:'countblank',description:'Counts the number of blank cells within a range.'},{name:'countif',description:'Counts the number of cells within a range that meet the given criteria.'},{name:'countifs',description:'Counts the number of cells within a range that meet multiple criteria.'},{name:'date',description:'Returns the serial number of a particular date.'},{name:'datedif',description:'Calculates the number of days, months, or years between two dates.'},{name:'day',description:'Converts a serial number to a day of the month.'},{name:'dcount',description:'Counts the cells that contain numbers in a database.'},{name:'exp',description:'Returns e raised to the power of a given number.'},{name:'false',description:'Returns the logical value FALSE.'},{name:'find',description:'Finds one text value within another (case-sensitive).'},{name:'floor',description:'Rounds a number down, toward zero.'},{name:'hlookup',description:'Looks in the top row of an array and returns the value of the indicated cell.'},{name:'hour',description:'Converts a serial number to an hour.'},{name:'if',description:'Specifies a logical test to perform.'},{name:'index',description:'Uses an index to choose a value from a reference.'},{name:'left',description:'Returns the leftmost characters from a text value.'},{name:'len',description:'Returns the number of characters in a text string.'},{name:'ln',description:'Returns the natural logarithm of a number.'},{name:'lower',description:'Converts text to lowercase.'},{name:'max',description:'Returns the maximum value in a list of arguments.'},{name:'mid',description:'Returns a specific number of characters from a text string starting at the position you specify.'},{name:'min',description:'Returns the minimum value in a list of arguments.'},{name:'mod',description:'Returns the remainder from division.'},{name:'month',description:'Converts a serial number to a month.'},{name:'not',description:'Reverses the logic of its argument.'},{name:'now',description:'Returns the serial number of the current date and time.'},{name:'or',description:'Returns TRUE if any argument is TRUE.'},{name:'pi',description:'Returns the value of pi.'},{name:'power',description:'Returns the result of a number raised to a power.'},{name:'product',description:'Multiplies its arguments.'},{name:'proper',description:'Capitalizes the first letter in each word of a text value.'},{name:'rand',description:'Returns a random number between 0 and 1.'},{name:'rank',description:'Returns the rank of a number in a list of numbers.'},{name:'rate',description:'Returns the interest rate per period of an annuity.'},{name:'replace',description:'Replaces characters within text.'},{name:'rept',description:'Repeats text a given number of times.'},{name:'right',description:'Returns the rightmost characters from a text value.'},{name:'round',description:'Rounds a number to a specified number of digits.'},{name:'rounddown',description:'Rounds a number down, toward zero.'},{name:'roundup',description:'Rounds a number up, away from zero.'},{name:'row',description:'Returns the row number of a reference.'},{name:'rows',description:'Returns the number of rows in a reference.'},{name:'search',description:'Finds one text value within another (not case-sensitive).'},{name:'sin',description:'Returns the sine of the given angle.'},{name:'sqrt',description:'Returns a positive square root.'},{name:'stdev',description:'Estimates standard deviation based on a sample.'},{name:'stdevp',description:'Calculates standard deviation based on the entire population.'},{name:'substitute',description:'Substitutes new text for old text in a text string.'},{name:'subtotal',description:'Returns a subtotal in a list or database.'},{name:'sum',description:'Adds its arguments.'},{name:'sumif',description:'Adds the cells specified by a given criteria.'},{name:'sumifs',description:'Adds the cells in a range that meet multiple criteria.'},{name:'tan',description:'Returns the tangent of a number.'},{name:'text',description:'Formats a number and converts it to text.'},{name:'time',description:'Returns the serial number of a particular time.'},{name:'today',description:'Returns the serial number of today\'s date.'},{name:'trim',description:'Removes spaces from text.'},{name:'true',description:'Returns the logical value TRUE.'},{name:'trunc',description:'Truncates a number to an integer.'},{name:'upper',description:'Converts text to uppercase.'},{name:'value',description:'Converts a text argument to a number.'},{name:'var',description:'Estimates variance based on a sample.'},{name:'varp',description:'Calculates variance based on the entire population.'},{name:'year',description:'Converts a serial number to a year.'}],s=function(o){function s(r,u){o.call(this,r,u);this._selectedSheetIndex=-1;this._columnHeaderClicked=!1;this._mouseMoveHdl=this._mouseMove.bind(this);this._clickHdl=this._click.bind(this);this.selectedSheetChanged=new n.Event;this.draggingRowColumn=new n.Event;this.droppingRowColumn=new n.Event;this.loaded=new n.Event;this.unknownFunction=new n.Event;this._eCt.style.backgroundColor='white';n.addClass(this.hostElement,'wj-flexsheet');n.setCss(this.hostElement,{fontFamily:'Arial'});this._cf=new i._FlexSheetCellFactory;this._init();this.showSort=!1;this.allowSorting=!1;this.showGroups=!1;this.showMarquee=!0;this.showSelectedHeaders=3;this.allowResizing=t.AllowResizing.Both;this.allowDragging=0}return __extends(s,o),Object.defineProperty(s.prototype,"sheets",{get:function(){return this._sheets||(this._sheets=new i.SheetCollection,this._sheets.selectedSheetChanged.addHandler(this._selectedSheetChange,this),this._sheets.collectionChanged.addHandler(this._sourceChange,this)),this._sheets},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"selectedSheetIndex",{get:function(){return this._selectedSheetIndex},set:function(n){n!==this._selectedSheetIndex&&(this._showSheet(n),this._sheets.selectedIndex=n)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"selectedSheet",{get:function(){return this._sheets[this._selectedSheetIndex]},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"isFunctionListOpen",{get:function(){return this._functionListHost.style.display!=='none'},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"isTabHolderVisible",{get:function(){return this._tabHolder.visible},set:function(n){n!==this._tabHolder.visible&&(this._divContainer.style.height=n?this._divContainer.parentElement.clientHeight-this._tabHolder.getSheetBlanketSize()+'px':this._divContainer.parentElement.clientHeight+'px',this._tabHolder.visible=n)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"undoStack",{get:function(){return this._undoStack},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"sortManager",{get:function(){return this._sortManager},enumerable:!0,configurable:!0}),s.prototype.onSelectedSheetChanged=function(n){this._sortManager._refresh();this.selectedSheetChanged.raise(this,n)},s.prototype.onDraggingRowColumn=function(n){this.draggingRowColumn.raise(this,n)},s.prototype.onDroppingRowColumn=function(){this.droppingRowColumn.raise(this,new n.EventArgs)},s.prototype.onLoaded=function(){this.loaded.raise(this,new n.EventArgs)},s.prototype.onUnknownFunction=function(n){this.unknownFunction.raise(this,n)},s.prototype.refresh=function(n){typeof n=="undefined"&&(n=!0);this._divContainer.style.height=this._divContainer.parentElement.clientHeight-(this.isTabHolderVisible?this._tabHolder.getSheetBlanketSize():0)+'px';o.prototype.refresh.call(this,n);this._tabHolder.adjustSize()},s.prototype.setCellData=function(t,i,r,u){typeof u=="undefined"&&(u=!1);var f=n.isString(r)&&r.length>1&&r[0]==='=';return this.cells.setCellData(t,i,r,u&&!f)},s.prototype.containsFocus=function(){return this.isFunctionListOpen||o.prototype.containsFocus.call(this)},s.prototype.addUnboundSheet=function(n,t,i,r,u){var f=this._addSheet(n,t,i,r,u);return f.selectionRanges.length===0&&f.selectionRanges.push(this.selection),f},s.prototype.addBoundSheet=function(n,t,i,r){var u=this._addSheet(n,0,0,i,r);return t&&(u.itemsSource=t),u.selectionRanges.length===0&&u.selectionRanges.push(this.selection),u},s.prototype.applyCellsStyle=function(n,t,r){typeof r=="undefined"&&(r=!1);var f,e,s=t||[this.selection],u,o,h;if(!n&&this._cloneStyle){this.selectedSheet._styledCells=JSON.parse(JSON.stringify(this._cloneStyle));this._cloneStyle=null;this.refresh(!1);return}if(s){for(t||r?r&&!this._cloneStyle&&(this._cloneStyle=JSON.parse(JSON.stringify(this.selectedSheet._styledCells))):(h=new i._CellStyleAction(this,this._cloneStyle),this._cloneStyle=null),o=0;o<s.length;o++)for(u=s[o],f=u.topRow;f<=u.bottomRow;f++)for(e=u.leftCol;e<=u.rightCol;e++)this._applyStyleForCell(f,e,n);t||r||(h.saveNewState(),this._undoStack._addAction(h))}t||this.refresh(!1)},s.prototype.freezeAtCursor=function(){var t,n,i,u;if(this.selection&&this.frozenRows===0&&this.frozenColumns===0){if(this._ptScrl.y<0)for(t=0;t<this.selection.topRow-1;t++)if(i=this.rows[t],!(i instanceof r))if(i._pos+this._ptScrl.y<0)i.visible=!1;else break;if(this._ptScrl.x<0)for(n=0;n<this.selection.leftCol-1;n++)if(u=this.columns[n],u._pos+this._ptScrl.x<0)this.columns[n].visible=!1;else break;this.frozenColumns=this.selection.leftCol>0?this.selection.leftCol:0;this.frozenRows=this.selection.topRow>0?this.selection.topRow:0;this.scrollIntoView(this.selection.topRow,this.selection.leftCol)}else{for(t=0;t<this.frozenRows-1;t++)this.rows[t].visible=!0;for(n=0;n<this.frozenColumns-1;n++)this.columns[n].visible=!0;this.frozenColumns=0;this.frozenRows=0;this.scrollIntoView(this.selection.topRow,this.selection.leftCol)}this.selectedSheet.grid.frozenRows=this.frozenRows;this.selectedSheet.grid.frozenColumns=this.frozenColumns},s.prototype.showColumnFilter=function(){var n=this.selection.col>0?this.selection.col:0;this._filter.editColumnFilter(this.columns[n])},s.prototype.clear=function(){this.selection=new t.CellRange;this.sheets.clear();this._selectedSheetIndex=-1;this.columns.clear();this.rows.clear();this.columnHeaders.columns.clear();this.rowHeaders.rows.clear();this._undoStack.clear();this._ptScrl=new n.Point;this.addUnboundSheet()},s.prototype.getSelectionFormatState=function(){var n,t,r=this.rows.length,u=this.columns.length,i={isBold:!1,isItalic:!1,isUnderline:!1,textAlign:'left',isMergedCell:!1};if(r===0||u===0)return i;if(this.selection){if(this.selection.row>=r||this.selection.row2>=r||this.selection.col>=u||this.selection.col2>=u)return i;for(n=this.selection.topRow;n<=this.selection.bottomRow;n++)for(t=this.selection.leftCol;t<=this.selection.rightCol;t++)this._checkCellFormat(n,t,i)}return i},s.prototype.insertRows=function(u,f){var e=n.isNumber(u)&&u>=0?u:this.selection&&this.selection.topRow>-1?this.selection.topRow:0,s=n.isNumber(f)?f:1,h=new i._RowsChangedAction(this),c=this.rows[e],o;if(!this.itemsSource){for(e===0&&c&&c.constructor===r&&(e=1),this._updateCellsForUpdatingRow(this.rows.length,e,s),this.rows.beginUpdate(),o=0;o<s;o++)this.rows.insert(e,new t.Row);this.rows.endUpdate();this.selection&&this.selection.row!==-1&&this.selection.col!==-1||(this.selection=new t.CellRange(0,0));this._copyTo(this.selectedSheet);h.saveNewState();this._undoStack._addAction(h)}},s.prototype.deleteRows=function(u,f){var c=n.isNumber(f)&&f>=0?f:this.selection&&this.selection.topRow>-1?this.selection.bottomRow-this.selection.topRow+1:1,s=n.isNumber(u)&&u>=0?u:this.selection&&this.selection.topRow>-1?this.selection.topRow:-1,e=n.isNumber(u)&&u>=0?u+c-1:this.selection&&this.selection.topRow>-1?this.selection.bottomRow:-1,l=new i._RowsChangedAction(this),a=!1,o,v,h;if(!this.itemsSource&&s>-1&&e>-1){for(this._updateCellsForUpdatingRow(this.rows.length,s,c,!0),this.rows.beginUpdate();e>=s;e--)(o=this.rows[e],o&&o.constructor===r)||(o.dataItem&&this.collectionView?(this.collectionView.beginUpdate(),v=this._getCvIndex(e),v>-1&&this.itemsSource.splice(e-1,1),this.collectionView.endUpdate()):this.rows.removeAt(e),a=!0);this.rows.endUpdate();h=this.rows.length;h===0?(this.selectedSheet.selectionRanges.length=0,this.select(new t.CellRange)):e===h-1?this.select(new t.CellRange(e,0,e,this.columns.length-1)):this.select(new t.CellRange(this.selection.topRow,this.selection.col,this.selection.topRow,this.selection.col2));this._copyTo(this.selectedSheet);a&&(l.saveNewState(),this._undoStack._addAction(l))}},s.prototype.insertColumns=function(r,u){var e=n.isNumber(r)&&r>=0?r:this.selection&&this.selection.leftCol>-1?this.selection.leftCol:0,o=n.isNumber(u)?u:1,s=new i._ColumnsChangedAction(this),f;if(!this.itemsSource){for(this._updateCellsForUpdatingColumn(this.columns.length,e,o),this.columns.beginUpdate(),f=0;f<o;f++)this.columns.insert(e,new t.Column);this.columns.endUpdate();this.selection&&this.selection.row!==-1&&this.selection.col!==-1||(this.selection=new t.CellRange(0,0));this._copyTo(this.selectedSheet);s.saveNewState();this._undoStack._addAction(s)}},s.prototype.deleteColumns=function(r,u){var e,s=n.isNumber(u)&&u>=0?u:this.selection&&this.selection.leftCol>-1?this.selection.rightCol-this.selection.leftCol+1:1,o=n.isNumber(r)&&r>=0?r:this.selection&&this.selection.leftCol>-1?this.selection.leftCol:-1,f=n.isNumber(r)&&r>=0?r+s-1:this.selection&&this.selection.leftCol>-1?this.selection.rightCol:-1,h=new i._ColumnsChangedAction(this);if(!this.itemsSource&&o>-1&&f>-1){for(this._updateCellsForUpdatingColumn(this.columns.length,o,s,!0),this.columns.beginUpdate();f>=o;f--)this.columns.removeAt(f),this._sortManager.deleteSortLevel(f);this.columns.endUpdate();this._sortManager.commitSort(!1);e=this.columns.length;e===0?(this.selectedSheet.selectionRanges.length=0,this.select(new t.CellRange)):f===e-1?this.select(new t.CellRange(0,f,this.rows.length-1,f)):this.select(new t.CellRange(this.selection.row,this.selection.leftCol,this.selection.row2,this.selection.leftCol));this._copyTo(this.selectedSheet);h.saveNewState();this._undoStack._addAction(h)}},s.prototype.mergeRange=function(n){var u,f,o,r=n||this.selection,e;if(r){if(r.rowSpan===1&&r.columnSpan===1)return;if(n||(e=new i._CellMergeAction(this)),!this._resetMergedRange(r))for(u=r.topRow;u<=r.bottomRow;u++)for(f=r.leftCol;f<=r.rightCol;f++)o=u*this.columns.length+f,this.selectedSheet._mergedRanges[o]=new t.CellRange(r.topRow,r.leftCol,r.bottomRow,r.rightCol);n||(e.saveNewState(),this._undoStack._addAction(e))}n||this.refresh(!0)},s.prototype.getMergedRange=function(n,i,r,u){typeof u=="undefined"&&(u=!0);var l=i*this.columns.length+r,f=this.selectedSheet?this.selectedSheet._mergedRanges[l]:null,e,s,h,c;return n===this.cells&&f?!f.isSingleCell&&(this.frozenRows>0||this.frozenColumns>0)&&(f.topRow<this.frozenRows&&f.bottomRow>=this.frozenRows||f.leftCol<this.frozenColumns&&f.rightCol>=this.frozenColumns)?(e=f.topRow,s=f.bottomRow,h=f.leftCol,c=f.rightCol,i>=this.frozenRows&&f.topRow<this.frozenRows&&(e=this.frozenRows),i<this.frozenRows&&f.bottomRow>=this.frozenRows&&(s=this.frozenRows-1),r>=this.frozenColumns&&f.leftCol<this.frozenColumns&&(h=this.frozenColumns),r<this.frozenColumns&&f.rightCol>=this.frozenColumns&&(c=this.frozenColumns-1),new t.CellRange(e,h,s,c)):f.clone():r>=0&&this.columns&&this.columns.length>r?o.prototype.getMergedRange.call(this,n,i,r,u):null},s.prototype.evaluate=function(n,t,i){return this._evaluate(n,t,i)},s.prototype.getCellValue=function(t,i,r,u){typeof r=="undefined"&&(r=!1);var e=this.columns[i],h=t*this.columns.length+i,o,s,f;return o=u?u._styledCells[h]:this.selectedSheet._styledCells[h],s=o&&o.format?o.format:'',f=u?u.grid.getCellData(t,i,!1):this.getCellData(t,i,!1),n.isString(f)&&f[0]==='='&&(f=this._evaluate(f,r?s:'',u,t,i)),n.isPrimitive(f)?r&&(e.dataMap&&(f=e.dataMap.getDisplayValue(f)),f=f!=null?n.Globalize.format(f,s||e.format):''):f&&(f=r?n.Globalize.format(f.value,s||f.format||e.format):f.value),f==null?'':f},s.prototype.showFunctionList=function(t){var i=this,e=i._cumulativeOffset(t),f=i._cumulativeOffset(i._root),r,u;i._functionTarget=n.tryCast(t,HTMLInputElement);i._functionTarget&&i._functionTarget.value&&i._functionTarget.value[0]==='='?(i._functionList._cv.filter=function(n){var u=n.actualvalue.toLowerCase(),t=i._getCurrentFormulaIndex(i._functionTarget.value),r;return(t===-1&&(t=0),r=i._functionTarget.value.substr(t+1).trim().toLowerCase(),r.length>0&&u.indexOf(r)===0||i._functionTarget.value==='=')?!0:!1},i._functionList.selectedIndex=0,r=e.y+t.clientHeight+2+(n.hasClass(t,'wj-grid-editor')?this._ptScrl.y:0),u=e.x+(n.hasClass(t,'wj-grid-editor')?this._ptScrl.x:0),n.setCss(i._functionListHost,{height:i._functionList._cv.items.length>5?'218px':'auto',display:i._functionList._cv.items.length>0?'block':'none',top:'',left:''}),i._functionListHost.scrollTop=0,i._functionListHost.offsetHeight+r>f.y+i._root.offsetHeight?r=r-t.clientHeight-i._functionListHost.offsetHeight-5:r+=5,i._functionListHost.offsetWidth+u>f.x+i._root.offsetWidth&&(u=f.x+i._root.offsetWidth-i._functionListHost.offsetWidth),n.setCss(i._functionListHost,{top:r,left:u})):i.hideFunctionList()},s.prototype.hideFunctionList=function(){this._functionListHost.style.display='none'},s.prototype.selectPreviousFunction=function(){var n=this._functionList.selectedIndex;n>0&&this._functionList.selectedIndex--},s.prototype.selectNextFunction=function(){var n=this._functionList.selectedIndex;n<this._functionList.itemsSource.length&&this._functionList.selectedIndex++},s.prototype.applyFunctionToCell=function(){var n=this,t;n._functionTarget&&(t=n._getCurrentFormulaIndex(n._functionTarget.value),t===-1?t=n._functionTarget.value.indexOf('='):t+=1,n._functionTarget.value=n._functionTarget.value.substring(0,t)+n._functionList.selectedValue+'(',n._functionTarget.value[0]!=='='&&(n._functionTarget.value='='+n._functionTarget.value),n._functionTarget.focus(),n.hideFunctionList())},s.prototype.save=function(n){var t=this._saveToWorkbook();return n&&t.save(n),t},s.prototype.saveToWorkbookOM=function(){var n=this._saveToWorkbook();return n._serialize()},s.prototype.load=function(t){var i,r,u=this;if(t instanceof Blob)r=new FileReader,r.onload=function(){var t=r.result;t=n.xlsx.Workbook._base64EncArr(new Uint8Array(t));i=new n.xlsx.Workbook;i.load(t);u._loadFromWorkbook(i)},r.readAsArrayBuffer(t);else if(t instanceof n.xlsx.Workbook)u._loadFromWorkbook(t);else{if(t instanceof ArrayBuffer)t=n.xlsx.Workbook._base64EncArr(new Uint8Array(t));else if(!n.isString(t))throw'Invalid workbook.';i=new n.xlsx.Workbook;i.load(t);u._loadFromWorkbook(i)}},s.prototype.loadFromWorkbookOM=function(t){var i;t instanceof n.xlsx.Workbook?i=t:(i=new n.xlsx.Workbook,i._deserialize(t));this._loadFromWorkbook(i)},s.prototype.undo=function(){this._undoStack.undo()},s.prototype.redo=function(){this._undoStack.redo()},s.prototype.select=function(n,t){typeof t=="undefined"&&(t=!0);var i,r,u;if(n.rowSpan!==this.rows.length&&n.columnSpan!==this.columns.length)for(r=n.topRow;r<=n.bottomRow;r++)for(u=n.leftCol;u<=n.rightCol;u++)i=this.getMergedRange(this.cells,r,u),i&&!n.equals(i)&&(n.row<=n.row2?(n.row=Math.min(n.topRow,i.topRow),n.row2=Math.max(n.bottomRow,i.bottomRow)):(n.row=Math.max(n.bottomRow,i.bottomRow),n.row2=Math.min(n.topRow,i.topRow)),n.col<=n.col2?(n.col=Math.min(n.leftCol,i.leftCol),n.col2=Math.max(n.rightCol,i.rightCol)):(n.col=Math.max(n.rightCol,i.rightCol),n.col2=Math.min(n.leftCol,i.leftCol)));this.collectionView&&n.topRow===0&&n.bottomRow===this.rows.length-1&&n.leftCol===0&&n.rightCol===this.columns.length-1&&(n.row=1,n.row2=this.rows.length-1);o.prototype.select.call(this,n,t)},s.prototype.getSelectedState=function(t,i){var f=0,e=n.asInt(t),s=n.asInt(i),h=!1,u,r,c;if(r=this.getMergedRange(this.cells,t,i),r&&(h=r.contains(this.selection.row,this.selection.col)||r.intersects(this.selection)),!this._enableMulSel||this.selection.contains(e,s)||h)return o.prototype.getSelectedState.call(this,e,s);if(this.selectedSheet.selectionRanges.length>0)for(c=this.selectedSheet.selectionRanges.length;f<c;f++)if((u=this.selectedSheet.selectionRanges[f],r&&(r.contains(u.row,u.col)||r.intersects(u)))||u.contains(e,s))return 1;return 0},s.prototype.addCustomFunction=function(n,t,i,r,u,f){typeof f=="undefined"&&(f=!1);this._calcEngine.addCustomFunction(n,t,r,u,f)&&this._functionList.itemsSource.push({displayValue:'<div class="wj-flexsheet-formula-name">'+n+'</div>'+(i?'<div class="wj-flexsheet-formula-description">'+i+'</div>':''),actualvalue:n})},s.prototype.dispose=function(){document.removeEventListener('mousemove',this._mouseMoveHdl);document.body.removeEventListener('click',this._clickHdl);o.prototype.dispose.call(this)},s.prototype._getCvIndex=function(n){var t;return n>-1&&this.collectionView?(t=this.rows[n],t instanceof r)?n:t.dataItem?o.prototype._getCvIndex.call(this,n):this.collectionView.currentPosition:-1},s.prototype._init=function(){var e=this,f=this,o=window.navigator.userAgent,s=function(n){document.removeEventListener('mouseup',s);f._mouseUp(n)};f._divContainer=f.hostElement.querySelector('[wj-part="container"]');f._tabHolder=new i._TabHolder(f.hostElement.querySelector('[wj-part="tab-holder"]'),f);f._contextMenu=new i._ContextMenu(f.hostElement.querySelector('[wj-part="context-menu"]'),f);f._gpCells=new u(f,1,f.rows,f.columns,f._eCt);f._gpCHdr=new u(f,2,f._hdrRows,f.columns,f._eCHdrCt);f._gpRHdr=new u(f,3,f.rows,f._hdrCols,f._eRHdrCt);f._gpTL=new u(f,4,f._hdrRows,f._hdrCols,f._eTLCt);f._sortManager=new i.SortManager(f);f._filter=new t.filter.FlexGridFilter(f);f._filter.filterApplied.addHandler(function(){f._wholeColumnsSelected&&(f.selection=new t.CellRange(f.selection.topRow,f.selection.col,f.rows.length-1,f.selection.col2))});f._calcEngine=new i._CalcEngine(f);f._calcEngine.unknownFunction.addHandler(function(n,t){f.onUnknownFunction(t)},f);f._initFuncsList();f._undoStack=new i.UndoStack(f);f.loadedRows.addHandler(function(){!f.itemsSource||f.rows[0]instanceof r||f.rows.insert(0,new r)});f.itemsSourceChanged.addHandler(function(){for(var n=0;n<f.columns.length;n++)f.columns[n].required=!1});f.rows.collectionChanged.addHandler(function(){f._clearForEmptySheet('rows')},f);f.columns.collectionChanged.addHandler(function(){f._clearForEmptySheet('columns')},f);f.addEventListener(f.hostElement,'mousedown',function(n){document.addEventListener('mouseup',s);f._mouseDown(n)},!0);f.addEventListener(f.hostElement,'drop',function(){f._columnHeaderClicked=!1});f.addEventListener(f.hostElement,'contextmenu',function(i){var r,u,o,s,h,c,l;i.pageX===0&&i.pageY===0&&f.selection.row>-1&&f.selection.col>-1&&f.rows.length>0&&f.columns.length>0?(o=f.columns[f.selection.col],u=f.rows[f.selection.row],s=o.pos+f.hostElement.offsetLeft+e._ptScrl.x,h=u.pos+f.hostElement.offsetTop+e._ptScrl.y,c=new n.Point(s+o.renderSize,h+u.renderSize),r=f.hitTest(s,h)):r=f.hitTest(i);i.preventDefault();r&&r.cellType!==0&&(e.itemsSource||f._contextMenu.show(i,c),l=new t.CellRange(r.row,r.col),r.cellType!==1||l.intersects(f.selection)||(f.selectedSheet.selectionRanges.length=0,f.selection=new t.CellRange(r.row,r.col)))});f.prepareCellForEdit.addHandler(f._prepareCellForEditHandler,f);f.cellEditEnded.addHandler(function(){setTimeout(function(){f.hideFunctionList()},200)});f.addEventListener(f.hostElement,'keydown',function(n){var t=!1;n.ctrlKey&&(n.keyCode===89&&(f._undoStack.redo(),t=!0),n.keyCode===90&&(f._undoStack.undo(),t=!0),t&&n.preventDefault());n.keyCode===27&&(f._contextMenu.hide(),n.preventDefault())});document.body.addEventListener('click',f._clickHdl);document.addEventListener('mousemove',f._mouseMoveHdl);(o.match(/iPad/i)||o.match(/iPhone/i))&&(f.addEventListener(f.hostElement,'touchstart',function(t){f._contextMenu.hide();f._longClickTimer=setTimeout(function(){var i;i=f.hitTest(t);i&&i.cellType!==0&&!f.itemsSource&&f._contextMenu.show(undefined,new n.Point(t.pageX+10,t.pageY+10))},500)}),f.addEventListener(f.hostElement,'touchend',function(){clearTimeout(f._longClickTimer)}));f.addEventListener(f.hostElement,'drop',function(){f._htDown=null})},s.prototype._initFuncsList=function(){var t=this;t._functionListHost=document.createElement('div');n.addClass(t._functionListHost,'wj-flexsheet-formula-list');document.querySelector('body').appendChild(t._functionListHost);t._functionListHost.style.display='none';t._functionListHost.style.position='absolute';t._functionList=new n.input.ListBox(t._functionListHost);t._functionList.isContentHtml=!0;t._functionList.itemsSource=t._getFunctions();t._functionList.displayMemberPath='displayValue';t._functionList.selectedValuePath='actualvalue';t.addEventListener(t._functionListHost,'click',t.applyFunctionToCell.bind(t));t.addEventListener(t._functionListHost,'keydown',function(n){n.keyCode===27&&(t.hideFunctionList(),n.preventDefault())})},s.prototype._getFunctions=function(){for(var i=[],t=0,n;t<e.length;t++)n=e[t],i.push({displayValue:'<div class="wj-flexsheet-formula-name">'+n.name+'</div><div class="wj-flexsheet-formula-description">'+n.description+'</div>',actualvalue:n.name});return i},s.prototype._getCurrentFormulaIndex=function(n){var t=-1;return['+','-','*','/','^','(','&'].forEach(function(i){var r=n.lastIndexOf(i);r>t&&(t=r)}),t},s.prototype._prepareCellForEditHandler=function(){var n=this,t=n._edtHdl._edt;t&&(n.addEventListener(t,'keydown',function(t){if(n.isFunctionListOpen)switch(t.keyCode){case 38:n.selectPreviousFunction();t.preventDefault();break;case 40:n.selectNextFunction();t.preventDefault();break;case 9:case 13:n.applyFunctionToCell();t.preventDefault();break;case 27:n.hideFunctionList();t.preventDefault()}}),n.addEventListener(t,'keyup',function(i){(i.keyCode>40||i.keyCode<32)&&i.keyCode!==9&&i.keyCode!==27&&setTimeout(function(){n.showFunctionList(t)},0)}))},s.prototype._addSheet=function(n,t,r,u,f){var e=new i.Sheet(this,f,n,t,r),o=this.selectedSheet;return this.sheets.isValidSheetName(e)||e._setValidName(this.sheets.getValidSheetName(e)),typeof u=='number'?(u<0&&(u=0),u>=this.sheets.length&&(u=this.sheets.length)):u=this.sheets.length,this.sheets.insert(u,e),this.sheets.selectedIndex!==u?this.sheets.selectedIndex=u:(this._copyTo(o),this._copyFrom(e)),e},s.prototype._showSheet=function(n){!this.sheets||!this.sheets.length||n>=this.sheets.length||n<0||n===this.selectedSheetIndex||this.sheets[n]&&!this.sheets[n].visible||(this.finishEditing(),this.selectedSheetIndex>-1&&this._copyTo(this.sheets[this.selectedSheetIndex]),this.sheets[n]&&(this._selectedSheetIndex=n,this._copyFrom(this.sheets[n])))},s.prototype._selectedSheetChange=function(n,t){this._showSheet(t.newValue);this.invalidate(!0);this.onSelectedSheetChanged(t)},s.prototype._sourceChange=function(){this.invalidate(!0)},s.prototype._applyStyleForCell=function(n,t,i){var f=this,u,o,e;f.rows[n]instanceof r||(e=n*f.columns.length+t,o=f.selectedSheet._mergedRanges[e],o&&(e=o.topRow*f.columns.length+o.leftCol),u=f.selectedSheet._styledCells[e],u?(u.className=i.className==='normal'?'':i.className||u.className,u.textAlign=i.textAlign||u.textAlign,u.verticalAlign=i.verticalAlign||u.verticalAlign,u.fontFamily=i.fontFamily||u.fontFamily,u.fontSize=i.fontSize||u.fontSize,u.backgroundColor=i.backgroundColor||u.backgroundColor,u.color=i.color||u.color,u.fontStyle=i.fontStyle==='none'?'':i.fontStyle||u.fontStyle,u.fontWeight=i.fontWeight==='none'?'':i.fontWeight||u.fontWeight,u.textDecoration=i.textDecoration==='none'?'':i.textDecoration||u.textDecoration,u.format=i.format||u.format):f.selectedSheet._styledCells[e]={className:i.className,textAlign:i.textAlign,verticalAlign:i.verticalAlign,fontStyle:i.fontStyle,fontWeight:i.fontWeight,fontFamily:i.fontFamily,fontSize:i.fontSize,textDecoration:i.textDecoration,backgroundColor:i.backgroundColor,color:i.color,format:i.format})},s.prototype._checkCellFormat=function(n,t,i){var u=n*this.columns.length+t,f=this.selectedSheet._mergedRanges[u],r;f&&(i.isMergedCell=!0,u=f.topRow*this.columns.length+f.leftCol);r=this.selectedSheet._styledCells[u];r&&(i.isBold=i.isBold||r.fontWeight==='bold',i.isItalic=i.isItalic||r.fontStyle==='italic',i.isUnderline=i.isUnderline||r.textDecoration==='underline');n===this.selection.row&&t===this.selection.col&&(r&&r.textAlign?i.textAlign=r.textAlign:t>-1&&(i.textAlign=this.columns[t].getAlignment()||i.textAlign))},s.prototype._resetMergedRange=function(n){for(var r,e,u,f,o,t,s=!1,i=n.topRow;i<=n.bottomRow;i++)for(r=n.leftCol;r<=n.rightCol;r++)if(e=i*this.columns.length+r,t=this.selectedSheet._mergedRanges[e],t)for(s=!0,u=t.topRow;u<=t.bottomRow;u++)for(f=t.leftCol;f<=t.rightCol;f++)o=u*this.columns.length+f,delete this.selectedSheet._mergedRanges[o];return s},s.prototype._updateCellsForUpdatingRow=function(n,t,i,r){var l=this,s,f,e,o,u,h={},c=n*this.columns.length;if(r)for(s=t*this.columns.length,f=s;f<c;f++)e=f-i*this.columns.length,o=this.selectedSheet._styledCells[f],o&&(f>=(t+i)*this.columns.length&&(this.selectedSheet._styledCells[e]=o),delete this.selectedSheet._styledCells[f]),u=this.selectedSheet._mergedRanges[f],u&&(t<=u.topRow&&t+i>u.bottomRow?delete this.selectedSheet._mergedRanges[f]:u.bottomRow<t||u.topRow>=t+i?(u.topRow>t&&(u.row-=i),u.row2-=i,this.selectedSheet._mergedRanges[e]=u,delete this.selectedSheet._mergedRanges[f]):this._updateCellMergeRangeForRow(u,t,i,h,!0));else for(s=t*this.columns.length-1,f=c-1;f>s;f--)e=f+this.columns.length*i,o=this.selectedSheet._styledCells[f],o&&(this.selectedSheet._styledCells[e]=o,delete this.selectedSheet._styledCells[f]),u=this.selectedSheet._mergedRanges[f],u&&(u.topRow<t&&u.bottomRow>=t?this._updateCellMergeRangeForRow(u,t,i,h):(u.row+=i,u.row2+=i,this.selectedSheet._mergedRanges[e]=u,delete this.selectedSheet._mergedRanges[f]));Object.keys(h).forEach(function(n){l.selectedSheet._mergedRanges[n]=h[n]})},s.prototype._updateCellMergeRangeForRow=function(n,t,i,r,u){var e,s,o,c,l,h,f;if(u)for(e=n.topRow;e<=n.bottomRow;e++)for(s=n.leftCol;s<=n.rightCol;s++)o=e*this.columns.length+s,c=o-i*this.columns.length,h=this.selectedSheet._mergedRanges[o],h&&(f=h.clone(),f.row>t&&(f.row-=f.row-t),f.row2-=f.row2<t+i-1?f.row2-t+1:i,e<t?r[o]=f:(e>=t+i&&(r[c]=f),delete this.selectedSheet._mergedRanges[o]));else for(e=n.bottomRow;e>=n.topRow;e--)for(s=n.rightCol;s>=n.leftCol;s--)if(o=e*this.columns.length+s,h=this.selectedSheet._mergedRanges[o],h){for(f=h.clone(),f.row2+=i,e<t&&(r[o]=f.clone()),l=1;l<=i;l++)c=o+this.columns.length*l,r[c]=f;delete this.selectedSheet._mergedRanges[o]}},s.prototype._updateCellsForUpdatingColumn=function(n,t,i,r){var a=this,u,e,o,h,s,f,c={},l=this.rows.length*n;if(r)for(u=t;u<l;u++)h=Math.floor(u/n),s=u%n,e=u-i*(h+(s>=t?1:0)),o=this.selectedSheet._styledCells[u],o&&((s<t||s>=t+i)&&(this.selectedSheet._styledCells[e]=o),delete this.selectedSheet._styledCells[u]),f=this.selectedSheet._mergedRanges[u],f&&(t<=f.leftCol&&t+i>f.rightCol?delete this.selectedSheet._mergedRanges[u]:f.rightCol<t||f.leftCol>=t+i?(f.leftCol>=t&&(f.col-=i,f.col2-=i),this.selectedSheet._mergedRanges[e]=f,delete this.selectedSheet._mergedRanges[u]):this._updateCellMergeRangeForColumn(f,t,i,n,c,!0));else for(u=l-1;u>=t;u--)h=Math.floor(u/n),s=u%n,e=u+h*i+(s>=t?1:0),o=this.selectedSheet._styledCells[u],o&&(this.selectedSheet._styledCells[e]=o,delete this.selectedSheet._styledCells[u]),f=this.selectedSheet._mergedRanges[u],f&&(f.leftCol<t&&f.rightCol>=t?this._updateCellMergeRangeForColumn(f,t,i,n,c):(f.leftCol>=t&&(f.col+=i,f.col2+=i),this.selectedSheet._mergedRanges[e]=f,delete this.selectedSheet._mergedRanges[u]));Object.keys(c).forEach(function(n){a.selectedSheet._mergedRanges[n]=c[n]})},s.prototype._updateCellMergeRangeForColumn=function(n,t,i,r,u,f){var s,e,h,c,a,l,o;if(f)for(s=n.topRow;s<=n.bottomRow;s++)for(e=n.leftCol;e<=n.rightCol;e++)h=s*r+e,c=h-i*(s+(e>=t?1:0)),l=this.selectedSheet._mergedRanges[h],l&&(o=l.clone(),o.col>t&&(o.col-=o.col-t),o.col2-=o.col2<t+i-1?o.col2-t+1:i,(e<t||e>=t+i)&&(u[c]=o),delete this.selectedSheet._mergedRanges[h]);else for(s=n.bottomRow;s>=n.topRow;s--)for(e=n.rightCol;e>=n.leftCol;e--)if(h=s*r+e,c=h+s*i+(e>=t?1:0),l=this.selectedSheet._mergedRanges[h],l){if(o=l.clone(),o.col2+=i,e===t&&(u[c-1]=o.clone()),e>=t)for(a=0;a<i;a++)u[c+a]=o;else u[c]=o;delete this.selectedSheet._mergedRanges[h]}},s.prototype._cloneMergedCells=function(){var i,n=this.selectedSheet._mergedRanges,t;if(null==n||"object"!=typeof n)return n;if(n instanceof Object){i={};for(t in n)n.hasOwnProperty(t)&&n[t]&&n[t].clone&&(i[t]=n[t].clone());return i}throw new Error("Unable to copy obj! Its type isn't supported.");},s.prototype._evaluate=function(n,t,i,r,u){return n&&n.length>1?(n=n[0]==='='?n:'='+n,this._calcEngine.evaluate(n,t,i,r,u)):n},s.prototype._copyTo=function(t){var u,f,e,i;if(t.grid.rows.clear(),t.grid.columns.clear(),t.grid.columnHeaders.columns.clear(),t.grid.rowHeaders.rows.clear(),this.itemsSource){if(t.grid.autoGenerateColumns=!1,t.itemsSource=this.itemsSource,t.grid.collectionView.beginUpdate(),!(t.grid.itemsSource instanceof n.collections.CollectionView))for(t.grid.collectionView.sortDescriptions.clear(),e=0;e<this.collectionView.sortDescriptions.length;e++)t.grid.collectionView.sortDescriptions.push(this.collectionView.sortDescriptions[e]);t._filterDefinition=this._filter.filterDefinition;this._resetFilterDefinition()}else t.itemsSource=null;for(u=0;u<this.columns.length;u++)t.grid.columns.push(this.columns[u]);for(t.grid.collectionView&&(this._resetMappedColumns(t.grid),t.grid.collectionView.endUpdate()),f=0;f<this.rows.length;f++)i=this.rows[f],this.itemsSource?i.dataItem||i instanceof r&&t.grid.rows[0]instanceof r&&t.grid.rows.splice(0,1,i):t.grid.rows.push(i);t.grid.autoGenerateColumns=!0;t.grid.frozenRows=this.frozenRows;t.grid.frozenColumns=this.frozenColumns;t.grid.selection=this.selection;t._scrollPosition=this.scrollPosition;this.columns._dirty=!0;this.rows._dirty=!0},s.prototype._copyFrom=function(t){var i=this,f,e,o,u;if(i._isCopying=!0,i.rows.clear(),i.columns.clear(),i.columnHeaders.columns.clear(),i.rowHeaders.rows.clear(),t.selectionRanges.length>1&&i.selectionMode===2&&(i._enableMulSel=!0),t.itemsSource){if(i.autoGenerateColumns=!1,i.itemsSource=t.itemsSource,i.collectionView.beginUpdate(),!(i.itemsSource instanceof n.collections.CollectionView))for(i.collectionView.sortDescriptions.clear(),o=0;o<t.grid.collectionView.sortDescriptions.length;o++)i.collectionView.sortDescriptions.push(t.grid.collectionView.sortDescriptions[o]);i.collectionView.collectionChanged.addHandler(function(n,t){t.action===3&&i.refresh()},i)}else i.itemsSource=null;for(f=0;f<t.grid.columns.length;f++)i.columns.push(t.grid.columns[f]);for(i.collectionView&&(i._resetMappedColumns(this),i.collectionView.endUpdate()),e=0;e<t.grid.rows.length;e++)u=t.grid.rows[e],i.itemsSource?u.dataItem||u instanceof r&&i.rows[0]instanceof r&&i.rows.splice(0,1,u):i.rows.push(u);i.rows.length&&i.columns.length&&(i.selection=t.grid.selection);t._filterDefinition&&(i._filter.filterDefinition=t._filterDefinition);i.autoGenerateColumns=!0;i.frozenRows=t.grid.frozenRows;i.frozenColumns=t.grid.frozenColumns;i._isCopying=!1;i.sheets.length===1?setTimeout(function(){i.rows._dirty=!0;i.columns._dirty=!0;i.refresh()},10):i.refresh();i.scrollPosition=t._scrollPosition},s.prototype._resetMappedColumns=function(n){var t,i,r=0;if(n._mappedColumns=null,n.collectionView)for(i=n.collectionView.sortDescriptions;r<i.length;r++)t=n.columns.getColumn(i[r].property),t&&t.dataMap&&(n._mappedColumns||(n._mappedColumns={}),n._mappedColumns[t.binding]=t.dataMap)},s.prototype._resetFilterDefinition=function(){this._filter.filterDefinition=JSON.stringify({defaultFilterType:3,filters:[]})},s.prototype._loadFromWorkbook=function(t){var u,r=0,i=this;if(t.sheets!=null&&t.sheets.length!==0){for(i.clear(),i._reservedContent=t.reservedContent,u=t.sheets.length;r<u;r++)r>0&&i.addUnboundSheet(),n.grid.xlsx.FlexGridXlsxConverter.load(i.selectedSheet.grid,t,{sheetIndex:r,includeColumnHeaders:!1}),i.selectedSheet.grid.wj_sheetInfo&&(i.selectedSheet.name=i.selectedSheet.grid.wj_sheetInfo.name,i.selectedSheet.visible=i.selectedSheet.grid.wj_sheetInfo.visible,i.selectedSheet._styledCells=i.selectedSheet.grid.wj_sheetInfo.styledCells,i.selectedSheet._mergedRanges=i.selectedSheet.grid.wj_sheetInfo.mergedRanges),i._copyFrom(i.selectedSheet);i.selectedSheetIndex=0;i.onLoaded()}},s.prototype._saveToWorkbook=function(){var i,u,t,r;if(this.sheets.length===0)throw'The flexsheet is empty.';for(t=this.sheets[0],i=n.grid.xlsx.FlexGridXlsxConverter.save(t.grid,{sheetName:t.name,sheetVisible:t.visible,includeColumnHeaders:!1}),i.reservedContent=this._reservedContent,r=1;r<this.sheets.length;r++)t=this.sheets[r],u=n.grid.xlsx.FlexGridXlsxConverter.save(t.grid,{sheetName:t.name,sheetVisible:t.visible,includeColumnHeaders:!1}),i._addWorkSheet(u.sheets[0],r);return i.activeWorksheet=this.selectedSheetIndex,i},s.prototype._mouseDown=function(i){var o=window.navigator.userAgent,r=this.hitTest(i),h=this.columns,u,e,s;if(this._wholeColumnsSelected=!1,this._dragable){this._isDragging=!0;this._draggingMarker=document.createElement('div');n.setCss(this._draggingMarker,{position:'absolute',display:'none',borderStyle:'dotted',cursor:'move'});document.body.appendChild(this._draggingMarker);this._draggingTooltip=new n.Tooltip;this._draggingCells=this.selection;this.selectedSheet.selectionRanges.length=0;this.onDraggingRowColumn(new f(this._draggingRow,i.shiftKey));i.preventDefault();return}if((r.cellType!==0&&(s=n.tryCast(i.target,HTMLInputElement),s==null&&this._checkHitWithinSelection(r)&&(this._edtHdl._htDown=r)),this.selectionMode===2?i.ctrlKey?this._enableMulSel||(this._enableMulSel=!0):(r.cellType===1&&(this.selectedSheet.selectionRanges.length=0,this._enableMulSel&&this.refresh(!1)),this._enableMulSel=!1):this._enableMulSel=!1,this.rows.length!==0&&this.columns.length!==0)&&(o.match(/iPad/i)||o.match(/iPhone/i)||this._contextMenu.hide(),this.selectionMode===2)){if(r.cellType===3&&i.which===3){e=new t.CellRange(r.row,0,r.row,this.columns.length-1);this.selection.contains(e)||(this.selection=e);return}if((r.cellType===2||r.cellType===0)&&(!(r.col>-1)||!this.columns[r.col].isSelected)&&n.hasClass(i.target,'wj-cell')&&!r.edgeRight)if(this._htDown=r,this._columnHeaderClicked=!0,this._wholeColumnsSelected=!0,i.shiftKey)this._multiSelectColumns(r);else{if(u=new t.CellRange(this.itemsSource?1:0,r.col,this.rows.length-1,r.col),i.which===3&&this.selection.contains(u))return;this.select(u)}}},s.prototype._mouseMove=function(n){var i=this.hitTest(n),r=this.selection,f=this.rows.length,e=this.columns.length,u=this.hostElement.style.cursor,o;if(this._isDragging){this.hostElement.style.cursor='move';this._showDraggingMarker(n);return}(o=this.itemsSource?r.topRow===0||r.topRow===1:r.topRow===0,r&&i.cellType!==0&&!this.itemsSource&&(this._draggingColumn=o&&r.bottomRow===f-1,this._draggingRow=r.leftCol===0&&r.rightCol===e-1,i.cellType===1?(this._draggingColumn&&((i.col===r.leftCol-1||i.col===r.rightCol)&&i.edgeRight||i.row===f-1&&i.edgeBottom)&&(u='move'),this._draggingRow&&!this._containsGroupRows(r)&&((i.row===r.topRow-1||i.row===r.bottomRow)&&i.edgeBottom||i.col===e-1&&i.edgeRight)&&(u='move')):i.cellType===2?i.edgeBottom&&(this._draggingColumn&&i.col>=r.leftCol&&i.col<=r.rightCol?u='move':this._draggingRow&&r.topRow===0&&(u='move')):i.cellType===3&&i.edgeRight&&(this._draggingColumn&&r.leftCol===0?u='move':this._draggingRow&&i.row>=r.topRow&&i.row<=r.bottomRow&&!this._containsGroupRows(r)&&(u='move')),this._dragable=u==='move'?!0:!1,this.hostElement.style.cursor=u),this._htDown&&this._htDown.panel)&&(i=new t.HitTestInfo(this._htDown.panel,n),this._multiSelectColumns(i),this.scrollIntoView(i.row,i.col))},s.prototype._mouseUp=function(n){this._isDragging&&(this._draggingCells.equals(this._dropRange)||(this._handleDropping(n),this.onDroppingRowColumn()),this._draggingCells=null,this._dropRange=null,document.body.removeChild(this._draggingMarker),this._draggingMarker=null,this._draggingTooltip.hide(),this._draggingTooltip=null,this._isDragging=!1,this._draggingColumn=!1,this._draggingRow=!1);this._htDown&&this._htDown.cellType===1&&this.selectedSheet.selectionRanges.push(this.selection);this._columnHeaderClicked=!1;this._htDown=null},s.prototype._click=function(){var n=this,t=window.navigator.userAgent;t.match(/iPad/i)||t.match(/iPhone/i)||n._contextMenu.hide();setTimeout(function(){n.hideFunctionList()},200)},s.prototype._showDraggingMarker=function(i){var l=new t.HitTestInfo(this.cells,i),a=this.selection,y=this.columns.length,p=this.rows.length,w=this._cumulativeScrollOffset(this.hostElement),f,u,r,o,h,c,e,v;if(this._draggingColumn){for(u=a.rightCol-a.leftCol+1,r=l.col,h=0,(r<0||r+u>y)&&(r=y-u),f=this.cells.getCellBoundingRect(0,r),c=this._root.offsetHeight-this._eCHdr.offsetHeight,o=this.cells.height,o=o>c?c:o,e=0;e<u;e++)h+=this.columns[r+e].renderSize;v=s.convertNumberToAlpha(r)+' : '+s.convertNumberToAlpha(r+u-1);this._dropRange?(this._dropRange.col=r,this._dropRange.col2=r+u-1):this._dropRange=new t.CellRange(0,r,this.rows.length-1,r+u-1)}else if(this._draggingRow){for(u=a.bottomRow-a.topRow+1,r=l.row,o=0,(r<0||r+u>p)&&(r=p-u),f=this.cells.getCellBoundingRect(r,0),c=this._root.offsetWidth-this._eRHdr.offsetWidth,e=0;e<u;e++)o+=this.rows[r+e].renderSize;h=this.cells.width;h=h>c?c:h;v=r+' : '+(r+u-1);this._dropRange?(this._dropRange.row=r,this._dropRange.row2=r+u-1):this._dropRange=new t.CellRange(r,0,r+u-1,this.columns.length-1)}f&&(n.setCss(this._draggingMarker,{display:'inline',opacity:.5,top:f.top-(this._draggingColumn?this._ptScrl.y:0)+w.y,left:f.left-(this._draggingRow?this._ptScrl.x:0)+w.x,height:o,width:h}),f.top=f.top-(this._draggingColumn?this._ptScrl.y:0),f.left=f.left-(this._draggingRow?this._ptScrl.x:0),this._draggingTooltip.show(this.hostElement,v,f),r===0&&this.scrollIntoView(l.row,l.col))},s.prototype._handleDropping=function(n){var t,r,u,f,e;if(this._draggingCells&&this._dropRange&&!this._containsMergedCells(this._draggingCells)&&!this._containsMergedCells(this._dropRange)){if(this._draggingColumn&&this._draggingCells.leftCol>this._dropRange.leftCol||this._draggingRow&&this._draggingCells.topRow>this._dropRange.topRow)if(n.shiftKey){if(this._draggingColumn)for(f=this._dropRange.leftCol,r=this._draggingCells.leftCol;r<=this._draggingCells.rightCol;r++)this.columns.moveElement(r,f),f++;else if(this._draggingRow)for(u=this._dropRange.topRow,t=this._draggingCells.topRow;t<=this._draggingCells.bottomRow;t++)this.rows.moveElement(t,u),u++;this._exchangeCellStyle(!0)}else{for(e=new i._MoveCellsAction(this,this._draggingCells,this._dropRange,n.ctrlKey),u=this._dropRange.topRow,t=this._draggingCells.topRow;t<=this._draggingCells.bottomRow;t++){for(f=this._dropRange.leftCol,r=this._draggingCells.leftCol;r<=this._draggingCells.rightCol;r++)this._moveCellContent(t,r,u,f,n.ctrlKey),f++;u++}e.saveNewState()&&this._undoStack._addAction(e)}else if(this._draggingColumn&&this._draggingCells.leftCol<this._dropRange.leftCol||this._draggingRow&&this._draggingCells.topRow<this._dropRange.topRow)if(n.shiftKey){if(this._draggingColumn)for(f=this._dropRange.rightCol,r=this._draggingCells.rightCol;r>=this._draggingCells.leftCol;r--)this.columns.moveElement(r,f),f--;else if(this._draggingRow)for(u=this._dropRange.bottomRow,t=this._draggingCells.bottomRow;t>=this._draggingCells.topRow;t--)this.rows.moveElement(t,u),u--;this._exchangeCellStyle(!1)}else{for(e=new i._MoveCellsAction(this,this._draggingCells,this._dropRange,n.ctrlKey),u=this._dropRange.bottomRow,t=this._draggingCells.bottomRow;t>=this._draggingCells.topRow;t--){for(f=this._dropRange.rightCol,r=this._draggingCells.rightCol;r>=this._draggingCells.leftCol;r--)this._moveCellContent(t,r,u,f,n.ctrlKey),f--;u--}e.saveNewState()&&this._undoStack._addAction(e)}this.select(this._dropRange);this.hostElement.focus()}},s.prototype._moveCellContent=function(n,t,i,r,u){var s=this.getCellData(n,t,!1),f=n*this.columns.length+t,e=i*this.columns.length+r,o=this.selectedSheet._styledCells[f];this.setCellData(i,r,s);o?this.selectedSheet._styledCells[e]=JSON.parse(JSON.stringify(o)):delete this.selectedSheet._styledCells[e];u||(this.setCellData(n,t,undefined),delete this.selectedSheet._styledCells[f])},s.prototype._exchangeCellStyle=function(n){for(var i,r,u,f,o=0,e=[],t=this._draggingCells.topRow;t<=this._draggingCells.bottomRow;t++)for(i=this._draggingCells.leftCol;i<=this._draggingCells.rightCol;i++)r=t*this.columns.length+i,this.selectedSheet._styledCells[r]?(e.push(JSON.parse(JSON.stringify(this.selectedSheet._styledCells[r]))),delete this.selectedSheet._styledCells[r]):e.push(undefined);if(n){if(this._draggingColumn)for(f=this._draggingCells.rightCol-this._draggingCells.leftCol+1,i=this._draggingCells.leftCol-1;i>=this._dropRange.leftCol;i--)for(t=0;t<this.rows.length;t++)r=t*this.columns.length+i,u=t*this.columns.length+i+f,this.selectedSheet._styledCells[r]?(this.selectedSheet._styledCells[u]=JSON.parse(JSON.stringify(this.selectedSheet._styledCells[r])),delete this.selectedSheet._styledCells[r]):delete this.selectedSheet._styledCells[u];else if(this._draggingRow)for(f=this._draggingCells.bottomRow-this._draggingCells.topRow+1,t=this._draggingCells.topRow-1;t>=this._dropRange.topRow;t--)for(i=0;i<this.columns.length;i++)r=t*this.columns.length+i,u=(t+f)*this.columns.length+i,this.selectedSheet._styledCells[r]?(this.selectedSheet._styledCells[u]=JSON.parse(JSON.stringify(this.selectedSheet._styledCells[r])),delete this.selectedSheet._styledCells[r]):delete this.selectedSheet._styledCells[u]}else if(this._draggingColumn)for(f=this._draggingCells.rightCol-this._draggingCells.leftCol+1,i=this._draggingCells.rightCol+1;i<=this._dropRange.rightCol;i++)for(t=0;t<this.rows.length;t++)r=t*this.columns.length+i,u=t*this.columns.length+i-f,this.selectedSheet._styledCells[r]?(this.selectedSheet._styledCells[u]=JSON.parse(JSON.stringify(this.selectedSheet._styledCells[r])),delete this.selectedSheet._styledCells[r]):delete this.selectedSheet._styledCells[u];else if(this._draggingRow)for(f=this._draggingCells.bottomRow-this._draggingCells.topRow+1,t=this._draggingCells.bottomRow+1;t<=this._dropRange.bottomRow;t++)for(i=0;i<this.columns.length;i++)r=t*this.columns.length+i,u=(t-f)*this.columns.length+i,this.selectedSheet._styledCells[r]?(this.selectedSheet._styledCells[u]=JSON.parse(JSON.stringify(this.selectedSheet._styledCells[r])),delete this.selectedSheet._styledCells[r]):delete this.selectedSheet._styledCells[u];for(t=this._dropRange.topRow;t<=this._dropRange.bottomRow;t++)for(i=this._dropRange.leftCol;i<=this._dropRange.rightCol;i++)r=t*this.columns.length+i,e[o]?this.selectedSheet._styledCells[r]=e[o]:delete this.selectedSheet._styledCells[r],o++},s.prototype._containsMergedCells=function(n){for(var i,r,t=n.topRow;t<=n.bottomRow;t++)for(i=n.leftCol;i<=n.rightCol;i++)if(r=t*this.columns.length+i,this.selectedSheet._mergedRanges[r])return!0;return!1},s.prototype._multiSelectColumns=function(n){var i;n&&this._columnHeaderClicked&&(i=new t.CellRange(n.row,n.col),i.row=0,i.row2=this.rows.length-1,i.col2=this.selection.col2,this.select(i))},s.prototype._cumulativeOffset=function(t){var i=0,r=0;do i+=t.offsetTop||0,r+=t.offsetLeft||0,t=t.offsetParent;while(t);return new n.Point(r,i)},s.prototype._cumulativeScrollOffset=function(t){var i=0,r=0;do i+=t.scrollTop||0,r+=t.scrollLeft||0,t=t.offsetParent;while(t&&!(t instanceof HTMLBodyElement));return i+=document.body.scrollTop||document.documentElement.scrollTop,r+=document.body.scrollLeft||document.documentElement.scrollLeft,new n.Point(r,i)},s.prototype._checkHitWithinSelection=function(n){var t;return n!=null&&n.cellType===1&&((t=this.getMergedRange(this.cells,n.row,n.col),t&&t.intersects(this.selection))||this.selection.row===n.row&&this.selection.col===n.col)?!0:!1},s.prototype._clearForEmptySheet=function(n){this.selectedSheet&&this[n].length===0&&this._isCopying!==!0&&(this.selectedSheet._mergedRanges=null,this.selectedSheet._styledCells=null,this.select(new t.CellRange))},s.prototype._containsGroupRows=function(n){for(var r,i=n.topRow;i<=n.bottomRow;i++)if(r=this.rows[i],r instanceof t.GroupRow)return!0;return!1},s.convertNumberToAlpha=function(n){var t='',i,r;if(n>=0)do i=Math.floor(n/26),r=n%26,t=String.fromCharCode(r+65)+t,n=i-1;while(i);return t},s.controlTemplate='<div style="width:100%;height:100%"><div wj-part="container" style="width:100%;">'+t.FlexGrid.controlTemplate+'<\/div><div wj-part="tab-holder" style="width:100%; min-width:100px"><\/div><div wj-part="context-menu" style="display:none;z-index:100;"><\/div><\/div>',s}(t.FlexGrid),f,o,u,r;i.FlexSheet=s;f=function(n){function t(t,i){n.call(this);this._isDraggingRows=t;this._isShiftKey=i}return __extends(t,n),Object.defineProperty(t.prototype,"isDraggingRows",{get:function(){return this._isDraggingRows},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isShiftKey",{get:function(){return this._isShiftKey},enumerable:!0,configurable:!0}),t}(n.EventArgs);i.DraggingRowColumnEventArgs=f;o=function(n){function t(t,i){n.call(this);this._funcName=t;this._params=i}return __extends(t,n),Object.defineProperty(t.prototype,"funcName",{get:function(){return this._funcName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),t}(n.EventArgs);i.UnknownFunctionEventArgs=o;u=function(t){function i(n,i,r,u,f){t.call(this,n,i,r,u,f)}return __extends(i,t),i.prototype.getSelectedState=function(n,i,r){var u,e,o,f;if(!this.grid)return undefined;if(u=this.grid.selectedSheet?this.grid.selectedSheet.selectionRanges:null,f=t.prototype.getSelectedState.call(this,n,i,r),f===0&&u&&u.length>0&&this.grid._enableMulSel&&this.cellType!==1)for(e=0;e<u.length;e++)o=u[e],this.grid.showSelectedHeaders&2&&this.cellType===3&&o.containsRow(n)&&(f=1),this.grid.showSelectedHeaders&1&&this.cellType===2&&o.containsColumn(i)&&(f=1);return f},i.prototype.setCellData=function(i,r,u,f){return typeof f=="undefined"&&(f=!0),u&&n.isString(u)&&u[0]==='='&&(f=!1),t.prototype.setCellData.call(this,i,r,u,f)},i.prototype._renderCell=function(i,r,u,f,e){var o=this.hostElement.childNodes[e],s,c=i*this.grid.columns.length+r,h=this.grid.getMergedRange(this,i,r);return(e=t.prototype._renderCell.call(this,i,r,u,f,e),this.cellType!==1)?e:h&&c>h.topRow*this.grid.columns.length+h.leftCol?e:(n.hasClass(o,'wj-state-selected')||n.hasClass(o,'wj-state-multi-selected')?(o.style.backgroundColor='',o.style.color=''):this.grid.selectedSheet&&(s=this.grid.selectedSheet._styledCells[c],o&&s&&(o.style.backgroundColor=s.backgroundColor,o.style.color=s.color)),e)},i}(t.GridPanel);i.FlexSheetPanel=u;r=function(n){function t(){n.call(this);this.isReadOnly=!0}return __extends(t,n),t}(t.Row);i.HeaderRow=r})(t.sheet||(t.sheet={}));var i=t.sheet})(n.grid||(n.grid={}));var t=n.grid}(wijmo||(wijmo={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){(function(t){(function(i){'use strict';var e=function(){function u(t,i,u,f,e){this._visible=!0;this._unboundSortDesc=new n.collections.ObservableArray;this._currentStyledCells={};this._currentMergedRanges={};this._scrollPosition=new n.Point;this.nameChanged=new n.Event;var o=this;o._owner=t;o._name=u;o._rowCount=n.isNumber(f)&&!isNaN(f)&&f>=0?f:200;o._columnCount=n.isNumber(e)&&!isNaN(e)&&e>=0?e:20;o._grid=i||this._createGrid();o._grid.itemsSourceChanged.addHandler(this._gridItemsSourceChanged,this);o._unboundSortDesc.collectionChanged.addHandler(function(){for(var i=o._unboundSortDesc,u,t=0;t<i.length;t++)if(u=n.tryCast(i[t],r),!u)throw'sortDescriptions array must contain SortDescription objects.';o._owner.rows.beginUpdate();o._owner.rows.sort(o._compareRows());o._owner.rows.endUpdate();o._owner.rows._dirty=!0;o._owner.rows._update();o._owner._copyTo(o._owner.selectedSheet)})}return Object.defineProperty(u.prototype,"grid",{get:function(){return this._grid},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"name",{get:function(){return this._name},set:function(t){if(!n.isNullOrWhiteSpace(t)&&(this._name&&this._name.toLowerCase()!==t.toLowerCase()||!this._name)){this._name=t;this._grid.wj_sheetInfo.name=t;this.onNameChanged(new n.EventArgs)}},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"visible",{get:function(){return this._visible},set:function(n){this._visible=n;this._grid.wj_sheetInfo.visible=n},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"rowCount",{get:function(){return this._grid!=null?this._grid.rows.length:0},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"columnCount",{get:function(){return this._grid!=null?this._grid.columns.length:0},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"selectionRanges",{get:function(){return this._selectionRanges||(this._selectionRanges=[]),this._selectionRanges},set:function(n){this._selectionRanges=n},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"itemsSource",{get:function(){return this._grid!=null?this._grid.itemsSource:null},set:function(n){this._grid==null?(this._createGrid(),this._grid.itemsSourceChanged.addHandler(this._gridItemsSourceChanged,this)):this._clearGrid();this._grid.autoGenerateColumns=!0;this._grid.itemsSource=n},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"_styledCells",{get:function(){return this._currentStyledCells||(this._currentStyledCells={}),this._currentStyledCells},set:function(n){this._currentStyledCells=n},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"_mergedRanges",{get:function(){return this._currentMergedRanges||(this._currentMergedRanges={}),this._currentMergedRanges},set:function(n){this._currentMergedRanges=n},enumerable:!0,configurable:!0}),u.prototype.onNameChanged=function(n){this.nameChanged.raise(this,n)},u.prototype.getCellStyle=function(n,t){var i,u=this._grid.rows.length,r=this._grid.columns.length;return n>=u||t>=r?null:(i=n*r+t,this._styledCells[i])},u.prototype._setValidName=function(n){this._name=n;this._grid.wj_sheetInfo.name=n},u.prototype._compareRows=function(){var t=this,i=this._unboundSortDesc;return function(r,u){for(var s,o=0;o<i.length;o++){var h=i[o],f=r._ubv?r._ubv[h.column._hash]:'',e=u._ubv?u._ubv[h.column._hash]:'';if(n.isString(f)&&f[0]==='='&&(f=t._owner.evaluate(f)),n.isString(e)&&e[0]==='='&&(e=t._owner.evaluate(e)),f!==f&&(f=null),e!==e&&(e=null),n.isString(f)&&(f=f.toLowerCase()+f),n.isString(e)&&(e=e.toLowerCase()+e),s=f<e?-1:f>e?1:0,s!==0)return h.ascending?+s:-s}return 0}},u.prototype._createGrid=function(){var r=document.createElement('div'),n,u,f,e;for(r.style.visibility='hidden',document.body.appendChild(r),n=new t.FlexGrid(r),document.body.removeChild(r),e=0;e<this._rowCount;e++)n.rows.push(new t.Row);for(f=0;f<this._columnCount;f++)u=new t.Column,u.required=!1,n.columns.push(u);return n.loadedRows.addHandler(function(){!n.itemsSource||n.rows[0]instanceof i.HeaderRow||n.rows.insert(0,new i.HeaderRow)}),n.wj_sheetInfo={name:this.name,visible:this.visible,styledCells:this._styledCells,mergedRanges:this._mergedRanges},n},u.prototype._clearGrid=function(){this._grid.rows.clear();this._grid.columns.clear();this._grid.columnHeaders.columns.clear();this._grid.rowHeaders.rows.clear()},u.prototype._gridItemsSourceChanged=function(){this._name===this._owner.selectedSheet.name&&this._owner._copyFrom(this)},u}(),u,f,r;i.Sheet=e;u=function(t){function i(){t.apply(this,arguments);this._current=-1;this.selectedSheetChanged=new n.Event;this.sheetNameChanged=new n.Event}return __extends(i,t),Object.defineProperty(i.prototype,"selectedIndex",{get:function(){return this._current},set:function(n){this._moveCurrentTo(n)},enumerable:!0,configurable:!0}),i.prototype.onSelectedSheetChanged=function(n){this.selectedSheetChanged.raise(this,n)},i.prototype.insert=function(i,r){var u=this,f=r.name?this.getValidSheetName(r):this._getUniqueName(),e;f!==r.name&&(r.name=f);r.nameChanged.addHandler(function(){u.isValidSheetName(r)||r._setValidName(u.getValidSheetName(r));e=new n.collections.NotifyCollectionChangedEventArgs(2,r,n.isNumber(i)?i:u.length-1);u.onSheetNameChanged(e)});t.prototype.insert.call(this,i,r)},i.prototype.removeAt=function(n){var i=this.hide(n);i&&t.prototype.removeAt.call(this,n)},i.prototype.onSheetNameChanged=function(n){this.sheetNameChanged.raise(this,n)},i.prototype.selectFirst=function(){return this._moveCurrentTo(0)},i.prototype.selectLast=function(){return this._moveCurrentTo(this.length-1)},i.prototype.selectPrevious=function(){return this._moveCurrentTo(this._current-1)},i.prototype.selectNext=function(){return this._moveCurrentTo(this._current+1)},i.prototype.hide=function(n){var t=!1;return n<0&&n>=this.length?!1:this[n].visible?(this[n].visible=!1,n===this._current&&(t=this._moveCurrentTo(n+1)),!t)?(this[n].visible=!0,t):!0:!1},i.prototype.show=function(n){return n<0&&n>=this.length?!1:(this[n].visible=!0,this._moveCurrentTo(n),!0)},i.prototype.clear=function(){t.prototype.clear.call(this);this._current=-1},i.prototype.isValidSheetName=function(n){var t=this._getSheetIndexFrom(n.name),i=this.indexOf(n);return t===-1||t===i},i.prototype.getValidSheetName=function(n){var t=n.name,i=1,u=this.indexOf(n),r;do{if(r=this._getSheetIndexFrom(t),r===-1||r===u)break;else t=n.name.concat((i+1).toString());i=i+1}while(1);return t},i.prototype._moveCurrentTo=function(t){var i=t,r;if(t<0||t>=this.length)return!1;while(i<this.length&&!this[i].visible)i++;if(i===this.length)for(i=t;i>=0&&!this[i].visible;)i--;if(i<0)return!1;if(i!==this._current){r=new n.PropertyChangedEventArgs('sheetIndex',this._current,i);this._current=i;this.onSelectedSheetChanged(r)}return!0},i.prototype._getSheetIndexFrom=function(n){var i,r,t;for(n=n?n.toLowerCase():'',t=0;t<this.length;t++)if(i=this[t],r=i.name?i.name.toLowerCase():'',r===n)return t;return-1},i.prototype._getUniqueName=function(){var n='Sheet1',t=0;do{if(this._getSheetIndexFrom(n)===-1)break;else n='Sheet'.concat((t+1).toString());t=t+1}while(1);return n},i}(n.collections.ObservableArray);i.SheetCollection=u;f=function(t){function i(n,i,r){t.call(this,n,r);var u=this;u._owner=i;u._sheets=i.sheets;u.hostElement.attributes.tabindex&&u.hostElement.attributes.removeNamedItem('tabindex');u._initControl();u.deferUpdate(function(){r&&u.initialize(r)})}return __extends(i,t),i.prototype.refresh=function(){this._tabContainer.innerHTML='';this._tabContainer.innerHTML=this._getSheetTabs();this._adjustSize()},i.prototype._sourceChanged=function(t,i){typeof i=="undefined"&&(i=n.collections.NotifyCollectionChangedEventArgs.reset);var r=i,u;switch(r.action){case 0:u=r.index-1;u<0&&(u=0);this._tabContainer.innerHTML='';this._tabContainer.innerHTML=this._getSheetTabs();this._adjustSize();break;case 1:this._tabContainer.removeChild(this._tabContainer.children[r.index]);this._adjustSize();break;default:this.invalidate()}},i.prototype._selectedSheetChanged=function(n,t){this._updateTabActive(t.oldValue,!1);this._updateTabActive(t.newValue,!0);this._adjustSize()},i.prototype._initControl=function(){var n=this;n.applyTemplate('',n.getTemplate(),{_tabContainer:'container',_sheetPage:'sheet-page',_newSheet:'new-sheet'});n.addEventListener(n._newSheet,'click',function(){n._owner.addUnboundSheet();n._tabContainer.parentElement.scrollLeft=n._tabContainer.offsetWidth});n._sheets.collectionChanged.addHandler(n._sourceChanged,this);n._sheets.selectedSheetChanged.addHandler(n._selectedSheetChanged,this);n._sheets.sheetNameChanged.addHandler(n._updateSheetName,this);n._initSheetPage();n._initSheetTab()},i.prototype._initSheetTab=function(){var n=this;n.addEventListener(n._tabContainer,'mousedown',function(t){var r=t.target,i;t.preventDefault();i=n._getItemIndex(n._tabContainer,r);n._scrollSheetTabContainer(r);i>-1&&(n._sheets.selectedIndex=i)})},i.prototype._initSheetPage=function(){var n=this;n.hostElement.querySelector('div.wj-sheet-page').addEventListener('click',function(t){var r=t.target.toString()==='[object HTMLButtonElement]'?t.target:t.target.parentElement,u=n._getItemIndex(n._sheetPage,r),i;switch(u){case 0:n._sheets.selectFirst();n._tabContainer.parentElement.scrollLeft=0;break;case 1:n._sheets.selectPrevious();i=n._tabContainer.children[n._sheets.selectedIndex];n._scrollSheetTabContainer(i);break;case 2:n._sheets.selectNext();i=n._tabContainer.children[n._sheets.selectedIndex];n._scrollSheetTabContainer(i);break;case 3:n._sheets.selectLast();n._tabContainer.parentElement.scrollLeft=n._tabContainer.offsetWidth}})},i.prototype._getSheetTabs=function(){for(var t='',n=0;n<this._sheets.length;n++)t+=this._getSheetElement(this._sheets[n],this._sheets.selectedIndex===n);return t},i.prototype._getSheetElement=function(n,t){typeof t=="undefined"&&(t=!1);var i='<li';return n.visible?t&&(i+=' class="active"'):i+=' class="hidden"',i+('>'+n.name+'</li>')},i.prototype._updateTabActive=function(t,i){t<0||t>=this._tabContainer.children.length||(i?n.addClass(this._tabContainer.children[t],'active'):n.removeClass(this._tabContainer.children[t],'active'))},i.prototype._updateTabShown=function(t,i){t<0||t>=this._tabContainer.children.length||(i?n.addClass(this._tabContainer.children[t],'hidden'):n.removeClass(this._tabContainer.children[t],'hidden'))},i.prototype._adjustSize=function(){var u=this._tabContainer.childElementCount,n,i,t=0,r=0;if(this.hostElement.style.display!=='none'){for(r=this._tabContainer.parentElement.scrollLeft,this._tabContainer.parentElement.style.width='',this._tabContainer.style.width='',this._sheetPage.parentElement.style.width='',n=0;n<u;n++)t+=this._tabContainer.children[n].offsetWidth+1;i=this.hostElement.offsetWidth-this._sheetPage.offsetWidth-this._newSheet.offsetWidth-2;this._tabContainer.parentElement.style.width=(t>i?i:t)+'px';this._tabContainer.style.width=t+'px';this._sheetPage.parentElement.style.width=this._sheetPage.offsetWidth+this._newSheet.offsetWidth+this._tabContainer.parentElement.offsetWidth+3+'px';this._tabContainer.parentElement.scrollLeft=r}},i.prototype._getItemIndex=function(n,t){for(var i=0;i<n.children.length;i++)if(n.children[i]===t)return i;return-1},i.prototype._updateSheetName=function(n,t){this._tabContainer.querySelectorAll('li')[t.index].textContent=t.item.name;this._adjustSize()},i.prototype._scrollSheetTabContainer=function(n){n.offsetLeft+n.offsetWidth-this._sheetPage.offsetWidth>this._tabContainer.parentElement.offsetWidth+this._tabContainer.parentElement.scrollLeft?this._tabContainer.parentElement.scrollLeft+=n.offsetWidth:n.offsetLeft-this._sheetPage.offsetWidth<this._tabContainer.parentElement.scrollLeft&&(this._tabContainer.parentElement.scrollLeft-=n.offsetWidth)},i.controlTemplate='<div class="wj-sheet" style="height:100%;position:relative"><div wj-part="sheet-page" class="wj-btn-group wj-sheet-page"><button type="button" class="wj-btn wj-btn-default"><span class="wj-sheet-icon wj-glyph-step-backward"><\/span><\/button><button type="button" class="wj-btn wj-btn-default"><span class="wj-sheet-icon wj-glyph-left"><\/span><\/button><button type="button" class="wj-btn wj-btn-default"><span class="wj-sheet-icon wj-glyph-right"><\/span><\/button><button type="button" class="wj-btn wj-btn-default"><span class="wj-sheet-icon wj-glyph-step-forward"><\/span><\/button><\/div><div class="wj-sheet-tab" style="height:100%;overflow:hidden"><ul wj-part="container"><\/ul><\/div><div wj-part="new-sheet" class="wj-new-sheet"><span class="wj-sheet-icon wj-glyph-file"><\/span><\/div><\/div>',i}(n.Control);i._SheetTabs=f;r=function(){function n(n,t){this._column=n;this._ascending=t}return Object.defineProperty(n.prototype,"column",{get:function(){return this._column},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"ascending",{get:function(){return this._ascending},enumerable:!0,configurable:!0}),n}();i._UnboundSortDescription=r})(t.sheet||(t.sheet={}));var i=t.sheet})(n.grid||(n.grid={}));var t=n.grid}(wijmo||(wijmo={})),function(n){(function(t){(function(t){'use strict';var r=function(){function r(t){this._owner=t;this._sortDescriptions=new n.collections.CollectionView;this._committedList=[new i(-1,!0)];this._sortDescriptions.newItemCreator=function(){return new i(-1,!0)};this._refresh()}return Object.defineProperty(r.prototype,"sortDescriptions",{get:function(){return this._sortDescriptions},set:function(n){this._sortDescriptions=n;this.commitSort(!0);this._refresh()},enumerable:!0,configurable:!0}),r.prototype.addSortLevel=function(){var n=this._sortDescriptions.addNew();this._sortDescriptions.commitNew()},r.prototype.deleteSortLevel=function(n){var t;t=n!=null?this._getSortItem(n):this._sortDescriptions.currentItem;t&&this._sortDescriptions.remove(t)},r.prototype.copySortLevel=function(){var n=this._sortDescriptions.currentItem,t;n&&(t=this._sortDescriptions.addNew(),t.columnIndex=parseInt(n.columnIndex),t.ascending=n.ascending,this._sortDescriptions.commitNew())},r.prototype.editSortLevel=function(n,t){n!==undefined&&(this._sortDescriptions.currentItem.columnIndex=n);t!==undefined&&(this._sortDescriptions.currentItem.ascending=t)},r.prototype.moveSortLevel=function(n){var t=this._sortDescriptions.currentItem;if(t){var i=this._sortDescriptions.sourceCollection,r=i.indexOf(t),u=r+n;r>-1&&u>-1&&(i.splice(r,1),i.splice(u,0,t),this._sortDescriptions.refresh(),this._sortDescriptions.moveCurrentTo(t))}},r.prototype.commitSort=function(r){var v=this,u,o,s,h,f,c,l,e,a;if(typeof r=="undefined"&&(r=!0),c=this._owner.selectedSheet._unboundSortDesc,a=this._owner.itemsSource&&this._owner.itemsSource instanceof n.collections.CollectionView,r&&(l=new t._SortColumnAction(this._owner)),this._committedList=this._sortDescriptions.itemCount>0?this._sortDescriptions.items.slice():[new i(-1,!0)],this._owner.collectionView){for(e=this._scanUnboundRows(),this._owner.collectionView.beginUpdate(),this._owner.selectedSheet.grid.collectionView.beginUpdate(),s=this._owner.collectionView.sortDescriptions,s.clear(),a===!1&&(h=this._owner.selectedSheet.grid.collectionView.sortDescriptions,h.clear()),f=0;f<this._sortDescriptions.itemCount;f++)u=this._sortDescriptions.items[f],u.columnIndex>-1&&(o=new n.collections.SortDescription(this._owner.columns[u.columnIndex].binding,u.ascending),s.push(o),a===!1&&h.push(o));this._owner.collectionView.endUpdate();this._owner.selectedSheet.grid.collectionView.endUpdate();e&&Object.keys(e).forEach(function(n){v._owner.rows.splice(+n,0,e[n])})}else for(c.clear(),f=0;f<this._sortDescriptions.itemCount;f++)u=this._sortDescriptions.items[f],u.columnIndex>-1&&c.push(new t._UnboundSortDescription(this._owner.columns[u.columnIndex],u.ascending));r&&(l.saveNewState(),this._owner.undoStack._addAction(l))},r.prototype.cancelSort=function(){this._sortDescriptions.sourceCollection=this._committedList.slice();this._refresh()},r.prototype._refresh=function(){var r=[],n,t;if(this._owner.collectionView&&this._owner.collectionView.sortDescriptions.length>0)for(n=0;n<this._owner.collectionView.sortDescriptions.length;n++)t=this._owner.collectionView.sortDescriptions[n],r.push(new i(this._getColumnIndex(t.property),t.ascending));else if(this._owner.selectedSheet&&this._owner.selectedSheet._unboundSortDesc.length>0)for(n=0;n<this._owner.selectedSheet._unboundSortDesc.length;n++)t=this._owner.selectedSheet._unboundSortDesc[n],r.push(new i(t.column.index,t.ascending));else r.push(new i(-1,!0));this._sortDescriptions.sourceCollection=r},r.prototype._getColumnIndex=function(n){for(var t=0,i=this._owner.columns.length;t<i;t++)if(this._owner.columns[t].binding===n)return t;return-1},r.prototype._getSortItem=function(n){for(var t=0,r=this._sortDescriptions.itemCount,i;t<r;t++)if(i=this._sortDescriptions.items[t],+i.columnIndex===n)return i;return undefined},r.prototype._scanUnboundRows=function(){for(var i,r,n=0;n<this._owner.rows.length;n++)i=this._owner.rows[n],i.dataItem||i instanceof t.HeaderRow||(r||(r={}),r[n]=i);return r},r}(),i;t.SortManager=r;i=function(){function n(n,t){this._columnIndex=n;this._ascending=t}return Object.defineProperty(n.prototype,"columnIndex",{get:function(){return this._columnIndex},set:function(n){this._columnIndex=n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"ascending",{get:function(){return this._ascending},set:function(n){this._ascending=n},enumerable:!0,configurable:!0}),n}();t.ColumnSortDescription=i})(t.sheet||(t.sheet={}));var i=t.sheet})(n.grid||(n.grid={}));var t=n.grid}(wijmo||(wijmo={})),function(n){(function(t){(function(t){'use strict';var i=function(){function i(i){var r=this;this.MAX_STACK_SIZE=500;this._stack=[];this._pointer=-1;this._resizingTriggered=!1;this.undoStackChanged=new n.Event;this._owner=i;this._owner.prepareCellForEdit.addHandler(this._initCellEditAction,this);this._owner.cellEditEnded.addHandler(function(){r._pendingAction instanceof t._EditAction&&!r._pendingAction.isPaste&&r._afterProcessCellEditAction(r)},this);this._owner.pasting.addHandler(this._initCellEditActionForPasting,this);this._owner.beginningEdit.addHandler(function(n,i){r._pendingAction instanceof t._EditAction&&r._pendingAction.isPaste&&r._pendingAction.resetEditAction(i.range)},this);this._owner.pasted.addHandler(function(){r._pendingAction instanceof t._EditAction&&r._pendingAction.isPaste&&r._afterProcessCellEditAction(r)},this);this._owner.resizingColumn.addHandler(function(n,i){r._resizingTriggered||(r._pendingAction=new t._ColumnResizeAction(r._owner,i.col),r._resizingTriggered=!0)},this);this._owner.resizedColumn.addHandler(function(){r._pendingAction instanceof t._ColumnResizeAction&&r._pendingAction.saveNewState()&&r._addAction(r._pendingAction);r._pendingAction=null;r._resizingTriggered=!1},this);this._owner.resizingRow.addHandler(function(n,i){r._resizingTriggered||(r._pendingAction=new t._RowResizeAction(r._owner,i.row),r._resizingTriggered=!0)},this);this._owner.resizedRow.addHandler(function(){r._pendingAction instanceof t._RowResizeAction&&r._pendingAction.saveNewState()&&r._addAction(r._pendingAction);r._pendingAction=null;r._resizingTriggered=!1},this);this._owner.draggingRowColumn.addHandler(function(n,i){i.isShiftKey&&(r._pendingAction=i.isDraggingRows?new t._RowsChangedAction(r._owner):new t._ColumnsChangedAction(r._owner))},this);this._owner.droppingRowColumn.addHandler(function(){r._pendingAction&&r._pendingAction.saveNewState()&&r._addAction(r._pendingAction);r._pendingAction=null},this)}return Object.defineProperty(i.prototype,"canUndo",{get:function(){return this._pointer>-1&&this._pointer<this._stack.length},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"canRedo",{get:function(){return this._pointer+1>-1&&this._pointer+1<this._stack.length},enumerable:!0,configurable:!0}),i.prototype.onUndoStackChanged=function(){this.undoStackChanged.raise(this)},i.prototype.undo=function(){var n;this.canUndo&&(n=this._stack[this._pointer],this._beforeUndoRedo(n),n.undo(),this._pointer--,this.onUndoStackChanged())},i.prototype.redo=function(){var n;this.canRedo&&(this._pointer++,n=this._stack[this._pointer],this._beforeUndoRedo(n),n.redo(),this.onUndoStackChanged())},i.prototype._addAction=function(n){this._stack.length>0&&this._stack.length>this._pointer+1&&this._stack.splice(this._pointer+1,this._stack.length-this._pointer-1);this._stack.length>=this.MAX_STACK_SIZE&&this._stack.splice(0,this._stack.length-this.MAX_STACK_SIZE+1);this._pointer=this._stack.length;this._stack.push(n);this.onUndoStackChanged()},i.prototype.clear=function(){this._stack.length=0},i.prototype._initCellEditAction=function(){this._pendingAction=new t._EditAction(this._owner)},i.prototype._initCellEditActionForPasting=function(){this._initCellEditAction();this._pendingAction.markIsPaste()},i.prototype._afterProcessCellEditAction=function(n){n._pendingAction instanceof t._EditAction&&n._pendingAction.saveNewState()&&n._addAction(this._pendingAction);n._pendingAction=null},i.prototype._beforeUndoRedo=function(n){this._owner.selectedSheetIndex=n.sheetIndex},i}();t.UndoStack=i})(t.sheet||(t.sheet={}));var i=t.sheet})(n.grid||(n.grid={}));var t=n.grid}(wijmo||(wijmo={}))